"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var serializer = require("./serializer");
var SupertypeLogger_1 = require("./SupertypeLogger");
/**
 * Allow the property to be either a boolean a function that returns a boolean or a string
 * matched against a rule set array of string in ObjectTemplate
 *
 * @param  prop unknown
 * @param ruleSet unknown
 *
 * @returns {function(this:ObjectTemplate)}
 */
function processProp(prop, ruleSet) {
    var ret = null;
    if (typeof (prop) === 'function') {
        ret = prop.call(ObjectTemplate);
    }
    else if (typeof (prop) === 'string') {
        ret = false;
        if (ruleSet) {
            ruleSet.map(function i(rule) {
                // this will always execute
                if (!ret) {
                    // double equals or single equals?
                    ret = rule == prop;
                }
            });
        }
    }
    else if (prop instanceof Array) {
        prop.forEach(function h(prop) {
            ret = ret || processProp(prop, ruleSet);
        });
    }
    else {
        ret = prop;
    }
    return ret;
}
function pruneExisting(obj, props) {
    var newProps = {};
    for (var prop in props) {
        if (typeof (obj[prop]) === 'undefined') {
            newProps[prop] = props[prop];
        }
    }
    return newProps;
}
/**
 * the og ObjectTemplate, what everything picks off of
 */
var ObjectTemplate = /** @class */ (function () {
    function ObjectTemplate() {
    }
    Object.defineProperty(ObjectTemplate, "statsdClient", {
        /**
         * Gets the statsDClient
         *
         * The statsDClient may be on the amorphic object, but it will always
         * redirect instead to the statsReference on amorphicStatic
         *
         * @static
         * @type {(StatsDClient | undefined)}
         * @memberof ObjectTemplate
         */
        get: function () {
            return this.amorphicStatic.__statsdClient__;
        },
        /**
         * Sets the statsDClient reference on amorphicStatic
         *
         * @static
         * @type {(StatsDClient | undefined)}
         * @memberof ObjectTemplate
         */
        set: function (statsClient) {
            this.amorphicStatic.__statsdClient__ = statsClient;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Purpose unknown
     */
    ObjectTemplate.performInjections = function () {
        this.getClasses();
        if (this.__templatesToInject__) {
            var objectTemplate_1 = this;
            for (var templateName in this.__templatesToInject__) {
                var template = this.__templatesToInject__[templateName];
                template.inject = function inject(injector) {
                    objectTemplate_1.inject(this, injector);
                };
                this._injectIntoTemplate(template);
            }
        }
    };
    ObjectTemplate.init = function () {
        this.__templateUsage__ = {};
        this.__injections__ = [];
        this.__dictionary__ = {};
        this.__anonymousId__ = 1;
        this.__templatesToInject__ = {};
        this.logger = this.logger || this.createLogger(); // Create a default logger
    };
    ObjectTemplate.getTemplateByName = function (name) {
        return this.getClasses()[name];
    };
    /**
 * Purpose unknown
 *
 * @param {unknown} template unknown
 * @param {unknown} name unknown
 * @param {unknown} props unknown
 */
    ObjectTemplate.setTemplateProperties = function (template, name, props) {
        this.__templatesToInject__[name] = template;
        this.__dictionary__[name] = template;
        template.__name__ = name;
        template.__injections__ = [];
        template.__objectTemplate__ = this;
        template.__children__ = [];
        template.__toClient__ = props.__toClient__;
        template.__toServer__ = props.__toServer__;
    };
    /**
     * Purpose unknown
     *
     * @param {unknown} props unknown
     *
     * @returns {unknown}
     */
    ObjectTemplate.getTemplateProperties = function (props) {
        var templateProperties = {};
        if (ObjectTemplate.__toClient__ == false) {
            props.toClient = false;
        }
        if (processProp(props.isLocal, this.isLocalRuleSet)) {
            props.toServer = false;
            props.toClient = false;
        }
        templateProperties.__toClient__ = processProp(props.toClient, this.toClientRuleSet) != false;
        templateProperties.__toServer__ = processProp(props.toServer, this.toServerRuleSet) != false;
        return templateProperties;
    };
    /**
        * Create an object template that is instantiated with the new operator.
        * properties is
        *
        * @param {unknown} name the name of the template or an object with
        *        name - the name of the class
        *        toClient - whether the object is to be shipped to the client (with semotus)
        *        toServer - whether the object is to be shipped to the server (with semotus)
        *        isLocal - equivalent to setting toClient && toServer to false
        * @param {unknown} properties an object whose properties represent data and function
        * properties of the object.  The data properties may use the defineProperty
        * format for properties or may be properties assigned a Number, String or Date.
        *
        * @returns {*} the object template
        */
    ObjectTemplate.create = function (name, properties) {
        /** this block only executes on createtypeforname */
        if (name && !(typeof (name) === 'string') && name.name) {
            var props = name;
            name = props.name;
        }
        else {
            props = {};
        }
        if (typeof (name) !== 'string' || name.match(/[^A-Za-z0-9_]/)) {
            throw new Error('incorrect template name');
        }
        if (typeof (properties) !== 'object') {
            throw new Error('missing template property definitions');
        }
        var createProps = this.getTemplateProperties(props);
        if (typeof (this.templateInterceptor) === 'function') {
            this.templateInterceptor('create', name, properties);
        }
        var template;
        if (properties) {
            template = this._createTemplate(null, Object, properties, createProps, name);
        }
        else {
            template = this._createTemplate(null, Object, name, createProps, name);
        }
        this.setTemplateProperties(template, name, createProps);
        template.__createProps__ = props;
        return template;
    };
    /**
     * Extend and existing (parent template)
     *
     * @param {unknown} parentTemplate unknown
     * @param {unknown} name the name of the template or an object with
     *        name - the name of the class
     *        toClient - whether the object is to be shipped to the client (with semotus)
     *        toServer - whether the object is to be shipped to the server (with semotus)
     *        isLocal - equivalent to setting toClient && toServer to false
     * @param {unknown} properties are the same as for create
     *
     * @returns {*} the object template
     */
    ObjectTemplate.extend = function (parentTemplate, name, properties) {
        var props;
        var createProps;
        if (!parentTemplate.__objectTemplate__) {
            throw new Error('incorrect parent template');
        }
        if (typeof (name) !== 'undefined' && typeof (name) !== 'string' && name.name) {
            props = name;
            name = props.name;
        }
        else {
            props = parentTemplate.__createProps__;
        }
        if (typeof (name) !== 'string' || name.match(/[^A-Za-z0-9_]/)) {
            throw new Error('incorrect template name');
        }
        if (typeof (properties) !== 'object') {
            throw new Error('missing template property definitions');
        }
        var existingTemplate = this.__dictionary__[name];
        if (existingTemplate) {
            if (existingTemplate.__parent__ != parentTemplate) {
                if (existingTemplate.__parent__.__name__ != parentTemplate.__name__) {
                    // eslint-disable-next-line no-console
                    console.log("WARN: Attempt to extend " + parentTemplate.__name__ + " as " + name + " but " + name + " was already extended from " + existingTemplate.__parent__.__name__);
                }
            }
            else {
                this.mixin(existingTemplate, properties);
                return existingTemplate;
            }
        }
        if (props) {
            createProps = this.getTemplateProperties(props);
        }
        if (typeof (this.templateInterceptor) === 'function') {
            this.templateInterceptor('extend', name, properties);
        }
        var template;
        if (properties) {
            template = this._createTemplate(null, parentTemplate, properties, parentTemplate, name);
        }
        else {
            template = this._createTemplate(null, parentTemplate, name, parentTemplate, name);
        }
        if (createProps) {
            this.setTemplateProperties(template, name, createProps);
        }
        else {
            this.setTemplateProperties(template, name, parentTemplate);
        }
        template.__createProps__ = props;
        // Maintain graph of parent and child templates
        template.__parent__ = parentTemplate;
        parentTemplate.__children__.push(template);
        return template;
    };
    ObjectTemplate.mixin = function (template, properties) {
        if (typeof (this.templateInterceptor) === 'function') {
            this.templateInterceptor('create', template.__name__, properties);
        }
        return this._createTemplate(template, null, properties, template, template.__name__);
    };
    /**
    * Purpose unknown
    *
    * @param {unknown} template unknown
    * @param {unknown} properties unknown
    */
    ObjectTemplate.staticMixin = function (template, properties) {
        for (var prop in properties) {
            template[prop] = properties[prop];
        }
    };
    /**
     * Add a function that will fire on object creation
     *
     * @param {unknown} template unknown
     * @param {Function} injector unknown
     */
    ObjectTemplate.inject = function (template, injector) {
        template.__injections__.push(injector);
    };
    /**
     * Add a function that will fire on all object creations (apparently)? Just a guess
     *
     * @param {Function} injector - unknown
     */
    ObjectTemplate.globalInject = function (injector) {
        this.__injections__.push(injector);
    };
    /**
     * Create the template if it needs to be created
     * @param [unknown} template to be created
     */
    ObjectTemplate.createIfNeeded = function (template, thisObj) {
        if (template.__createParameters__) {
            var createParameters = template.__createParameters__;
            for (var ix = 0; ix < createParameters.length; ++ix) {
                var params = createParameters[ix];
                template.__createParameters__ = undefined;
                this._createTemplate(params[0], params[1], params[2], params[3], params[4], true);
            }
            if (template._injectProperties) {
                template._injectProperties();
            }
            if (thisObj) {
                //var copy = new template();
                var prototypes_1 = [template.prototype];
                var parent_1 = template.__parent__;
                while (parent_1) {
                    prototypes_1.push(parent_1.prototype);
                    parent_1 = parent_1.__parent__;
                }
                var _loop_1 = function () {
                    var props = Object.getOwnPropertyNames(prototypes_1[ix]);
                    props.forEach(function (val, ix) {
                        Object.defineProperty(thisObj, props[ix], Object.getOwnPropertyDescriptor(prototypes_1[ix], props[ix]));
                    });
                };
                for (var ix = prototypes_1.length - 1; ix >= 0; --ix) {
                    _loop_1();
                }
                thisObj.__proto__ = template.prototype;
            }
        }
    };
    ObjectTemplate.getClasses = function () {
        if (this.__templates__) {
            for (var ix = 0; ix < this.__templates__.length; ++ix) {
                var template = this.__templates__[ix];
                this.__dictionary__[constructorName(template)] = template;
                this.__templatesToInject__[constructorName(template)] = template;
                processDeferredTypes(template);
            }
            this.__templates__ = undefined;
            for (var templateName1 in this.__dictionary__) {
                var template = this.__dictionary__[templateName1];
                var parentTemplateName = constructorName(Object.getPrototypeOf(template.prototype).constructor);
                template.__shadowParent__ = this.__dictionary__[parentTemplateName];
                if (template.__shadowParent__) {
                    template.__shadowParent__.__shadowChildren__.push(template);
                }
                template.props = {};
                var propst = ObjectTemplate._getDefineProperties(template, undefined, true);
                for (var propd in propst) {
                    template.props[propd] = propst[propd];
                }
            }
            if (this.__exceptions__) {
                throw new Error(this.__exceptions__.map(createMessageLine).join('\n'));
            }
        }
        function createMessageLine(exception) {
            return exception.func(exception.class(), exception.prop);
        }
        function processDeferredTypes(template) {
            if (template.prototype.__deferredType__) {
                for (var prop in template.prototype.__deferredType__) {
                    var defineProperty = template.defineProperties[prop];
                    if (defineProperty) {
                        var type = template.prototype.__deferredType__[prop]();
                        if (defineProperty.type === Array) {
                            defineProperty.of = type;
                        }
                        else {
                            defineProperty.type = type;
                        }
                    }
                }
            }
        }
        return this.__dictionary__;
        function constructorName(constructor) {
            var namedFunction = constructor.toString().match(/function ([^(]*)/);
            return namedFunction ? namedFunction[1] : null;
        }
    };
    /**
     * Overridden by other Type Systems to cache or globally identify objects
     * Also assigns a unique internal Id so that complex structures with
     * recursive objects can be serialized
     *
     * @param {unknown} obj - the object to be passed during creation time
     * @param {unknown} template - unknown
     *
     * @returns {unknown}
     *
     * @private
     */
    ObjectTemplate._stashObject = function (obj, template) {
        if (!obj.__id__) {
            if (!ObjectTemplate.nextId) {
                ObjectTemplate.nextId = 1;
            }
            obj.__id__ = 'local-' + template.__name__ + '-' + ++ObjectTemplate.nextId;
        }
        return false;
    };
    /**
     * Overridden by other Type Systems to inject other elements
     *
     * @param {_template} _template - the object to be passed during creation time
     *
     * @private
     * */
    ObjectTemplate._injectIntoTemplate = function (_template) { };
    ;
    /**
     * Used by template setup to create an property descriptor for use by the constructor
     *
     * @param {unknown} propertyName is the name of the property
     * @param {unknown} defineProperty is the property descriptor passed to the template
     * @param {unknown} objectProperties is all properties that will be processed manually.  A new property is
     *                         added to this if the property needs to be initialized by value
     * @param {unknown} defineProperties is all properties that will be passed to Object.defineProperties
     *                         A new property will be added to this object
     *
     * @private
     */
    ObjectTemplate._setupProperty = function (propertyName, defineProperty, objectProperties, defineProperties) {
        // Determine whether value needs to be re-initialized in constructor
        var value = defineProperty.value;
        var byValue = value && typeof (value) !== 'number' && typeof (value) !== 'string';
        if (byValue || !Object.defineProperties || defineProperty.get || defineProperty.set) {
            objectProperties[propertyName] = {
                init: defineProperty.value,
                type: defineProperty.type,
                of: defineProperty.of,
                byValue: byValue
            };
            delete defineProperty.value;
        }
        // When a super class based on objectTemplate don't transport properties
        defineProperty.toServer = false;
        defineProperty.toClient = false;
        defineProperties[propertyName] = defineProperty;
        // Add getters and setters
        if (defineProperty.get || defineProperty.set) {
            var userSetter_1 = defineProperty.set;
            defineProperty.set = (function d() {
                // Use a closure to record the property name which is not passed to the setter
                var prop = propertyName;
                return function c(value) {
                    if (userSetter_1) {
                        value = userSetter_1.call(this, value);
                    }
                    if (!defineProperty.isVirtual) {
                        this["__" + prop] = value;
                    }
                };
            })();
            var userGetter_1 = defineProperty.get;
            defineProperty.get = (function get() {
                // Use closure to record property name which is not passed to the getter
                var prop = propertyName;
                return function b() {
                    if (userGetter_1) {
                        if (defineProperty.isVirtual) {
                            return userGetter_1.call(this, undefined);
                        }
                        return userGetter_1.call(this, this["__" + prop]);
                    }
                    return this["__" + prop];
                };
            })();
            if (!defineProperty.isVirtual) {
                defineProperties["__" + propertyName] = { enumerable: false, writable: true };
            }
            delete defineProperty.value;
            delete defineProperty.writable;
        }
    };
    /**
     * Clone an object created from an ObjectTemplate
     * Used only within supertype (see copyObject for general copy)
     *
     * @param obj is the source object
     * @param template is the template used to create the object
     *
     * @returns {*} a copy of the object
     */
    // Function to clone simple objects using ObjectTemplate as a guide
    ObjectTemplate.clone = function (obj, template) {
        var copy;
        if (obj instanceof Date) {
            return new Date(obj.getTime());
        }
        else if (obj instanceof Array) {
            copy = [];
            for (var ix = 0; ix < obj.length; ++ix) {
                copy[ix] = this.clone(obj[ix], template);
            }
            return copy;
        }
        else if (template && obj instanceof template) {
            copy = new template();
            for (var prop in obj) {
                if (prop != '__id__' && !(obj[prop] instanceof Function)) {
                    var defineProperty = this._getDefineProperty(prop, template) || {};
                    if (obj.hasOwnProperty(prop)) {
                        copy[prop] = this.clone(obj[prop], defineProperty.of || defineProperty.type || null);
                    }
                }
            }
            return copy;
        }
        else if (obj instanceof Object) {
            copy = {};
            for (var propc in obj) {
                if (obj.hasOwnProperty(propc)) {
                    copy[propc] = this.clone(obj[propc]);
                }
            }
            return copy;
        }
        else {
            return obj;
        }
    };
    /**
     * Overridden by other Type Systems to be able to create remote functions or
     * otherwise intercept function calls
     *
     * @param {unknown} _propertyName is the name of the function
     * @param {unknown} propertyValue is the function itself
     *
     * @returns {*} a new function to be assigned to the object prototype
     *
     * @private
     */
    ObjectTemplate._setupFunction = function (_propertyName, propertyValue) {
        return propertyValue;
    };
    ;
    /**
 * Purpose unknown
 *
 * @param {unknown} obj unknown
 * @param {unknown} creator unknown
 *
 * @returns {unknown}
 */
    ObjectTemplate.createCopy = function (obj, creator) {
        return this.fromPOJO(obj, obj.__template__, null, null, undefined, null, null, creator);
    };
    /**
     * Abstract function for benefit of Semotus
     *
     * @param {unknown} cb unknown
     */
    ObjectTemplate.withoutChangeTracking = function (cb) {
        cb();
    };
    /**
/**
 * Find the right subclass to instantiate by either looking at the
 * declared list in the subClasses define property or walking through
 * the subclasses of the declared template
 *
 * @param {unknown} template unknown
 * @param {unknown} objId unknown
 * @param {unknown} defineProperty unknown
 * @returns {*}
 * @private
 */
    ObjectTemplate._resolveSubClass = function (template, objId, defineProperty) {
        var templateName = '';
        if (objId.match(/-([A-Za-z0-9_:]*)-/)) {
            templateName = RegExp.$1;
        }
        // Resolve template subclass for polymorphic instantiation
        if (defineProperty && defineProperty.subClasses && objId != 'anonymous)') {
            if (templateName) {
                for (var ix = 0; ix < defineProperty.subClasses.length; ++ix) {
                    if (templateName == defineProperty.subClasses[ix].__name__) {
                        template = defineProperty.subClasses[ix];
                    }
                }
            }
        }
        else {
            var subClass = this._findSubClass(template, templateName);
            if (subClass) {
                template = subClass;
            }
        }
        return template;
    };
    /**
     * Walk recursively through extensions of template via __children__
     * looking for a name match
     *
     * @param {unknown} template unknown
     * @param {unknown} templateName unknown
     * @returns {*}
     * @private
     */
    ObjectTemplate._findSubClass = function (template, templateName) {
        if (template.__name__ == templateName) {
            return template;
        }
        for (var ix = 0; ix < template.__children__.length; ++ix) {
            var subClass = this._findSubClass(template.__children__[ix], templateName);
            if (subClass) {
                return subClass;
            }
        }
        return null;
    };
    /**
     * Return the highest level template
     *
     * @param {unknown} template unknown
     *
     * @returns {*}
     *
     * @private
     */
    ObjectTemplate._getBaseClass = function (template) {
        while (template.__parent__) {
            template = template.__parent__;
        }
        return template;
    };
    /**
 * An overridable function used to create an object from a template and optionally
 * manage the caching of that object (used by derivative type systems).  It
 * preserves the original id of an object
 *
 * @param {unknown} template of object
 * @param {unknown} objId and id (if present)
 * @param {unknown} defineProperty unknown
 * @returns {*}
 * @private
 */
    ObjectTemplate._createEmptyObject = function (template, objId, defineProperty) {
        template = this._resolveSubClass(template, objId, defineProperty);
        var oldStashObject = this._stashObject;
        if (objId) {
            this._stashObject = function stashObject() {
                return true;
            };
        }
        var newValue = new template();
        this._stashObject = oldStashObject;
        if (objId) {
            newValue.__id__ = objId;
        }
        return newValue;
    };
    /**
     * Looks up a property in the defineProperties saved with the template cascading
     * up the prototype chain to find it
     *
     * @param {unknown} prop is the property being sought
     * @param {unknown} template is the template used to create the object containing the property
     * @returns {*} the "defineProperty" structure for the property
     * @private
     */
    ObjectTemplate._getDefineProperty = function (prop, template) {
        if (template && (template != Object) && template.defineProperties && template.defineProperties[prop]) {
            return template.defineProperties[prop];
        }
        else if (template && template.parentTemplate) {
            return this._getDefineProperty(prop, template.parentTemplate);
        }
        return null;
    };
    /**
     * Returns a hash of all properties including those inherited
     *
     * @param {unknown} template is the template used to create the object containing the property
     * @param {unknown} returnValue unknown
     * @param {unknown} includeVirtual unknown
     * @returns {*} an associative array of each "defineProperty" structure for the property
     * @private
     */
    ObjectTemplate._getDefineProperties = function (template, returnValue, includeVirtual) {
        if (!returnValue) {
            returnValue = {};
        }
        if (template.defineProperties) {
            for (var prop in template.defineProperties) {
                if (includeVirtual || !template.defineProperties[prop].isVirtual) {
                    returnValue[prop] = template.defineProperties[prop];
                }
            }
        }
        if (template.parentTemplate) {
            this._getDefineProperties(template.parentTemplate, returnValue, includeVirtual);
        }
        return returnValue;
    };
    /**
     *
     * General function to create templates used by create, extend and mixin
     *
     * @param {unknown} mixinTemplate - template used for a mixin
     * @param {unknown} parentTemplate - template used for an extend
     * @param {unknown} propertiesOrTemplate - properties to be added/mxied in
     * @param {unknown} createProperties unknown
     * @param {unknown} templateName - the name of the template as it will be stored retrieved from dictionary
     *
     * @returns {Function}
     *
     * @private
     */
    ObjectTemplate._createTemplate = function (mixinTemplate, parentTemplate, propertiesOrTemplate, createProperties, templateName, createTemplateNow) {
        // We will return a constructor that can be used in a new function
        // that will call an init() function found in properties, define properties using Object.defineProperties
        // and make copies of those that are really objects
        var functionProperties = {}; // Will be populated with init function from properties
        var objectProperties = {}; // List of properties to be processed by hand
        var defineProperties = {}; // List of properties to be sent to Object.defineProperties()
        var objectTemplate = this;
        var templatePrototype;
        function F() { } // Used in case of extend
        if (!this.lazyTemplateLoad) {
            createTemplateNow = true;
        }
        // Setup variables depending on the type of call (create, extend, mixin)
        if (createTemplateNow) {
            if (mixinTemplate) { // Mixin
                this.createIfNeeded(mixinTemplate);
                if (propertiesOrTemplate.isObjectTemplate) {
                    this.createIfNeeded(propertiesOrTemplate);
                    for (var prop in propertiesOrTemplate.defineProperties) {
                        mixinTemplate.defineProperties[prop] = propertiesOrTemplate.defineProperties[prop];
                    }
                    for (var propp in propertiesOrTemplate.objectProperties) {
                        mixinTemplate.objectProperties[propp] = propertiesOrTemplate.objectProperties[propp];
                    }
                    for (var propo in propertiesOrTemplate.functionProperties) {
                        if (propo == 'init') {
                            mixinTemplate.functionProperties.init = mixinTemplate.functionProperties.init || [];
                            for (var ix = 0; ix < propertiesOrTemplate.functionProperties.init.length; ++ix) {
                                mixinTemplate.functionProperties.init.push(propertiesOrTemplate.functionProperties.init[ix]);
                            }
                        }
                        else {
                            mixinTemplate.functionProperties[propo] = propertiesOrTemplate.functionProperties[propo];
                        }
                    }
                    for (var propn in propertiesOrTemplate.prototype) {
                        var propDesc = Object.getOwnPropertyDescriptor(propertiesOrTemplate.prototype, propn);
                        if (propDesc) {
                            Object.defineProperty(mixinTemplate.prototype, propn, propDesc);
                            if (propDesc.get) {
                                Object.getOwnPropertyDescriptor(mixinTemplate.prototype, propn).get.sourceTemplate = propDesc.get.sourceTemplate;
                            }
                        }
                        else {
                            mixinTemplate.prototype[propn] = propertiesOrTemplate.prototype[propn];
                        }
                    }
                    mixinTemplate.props = {};
                    var props = ObjectTemplate._getDefineProperties(mixinTemplate, undefined, true);
                    for (var propm in props) {
                        mixinTemplate.props[propm] = props[propm];
                    }
                    return mixinTemplate;
                }
                else {
                    defineProperties = mixinTemplate.defineProperties;
                    objectProperties = mixinTemplate.objectProperties;
                    functionProperties = mixinTemplate.functionProperties;
                    templatePrototype = mixinTemplate.prototype;
                    parentTemplate = mixinTemplate.parentTemplate;
                }
            }
            else { // Extend
                this.createIfNeeded(parentTemplate);
                F.prototype = parentTemplate.prototype;
                templatePrototype = new F();
            }
        }
        /**
         * Constructor that will be returned will only ever be created once
         */
        var template = this.__dictionary__[templateName] ||
            bindParams(templateName, objectTemplate, functionProperties, defineProperties, parentTemplate, propertiesOrTemplate, createProperties, objectProperties, templatePrototype, createTemplateNow, mixinTemplate);
        template.isObjectTemplate = true;
        template.extend = function (p1, p2) { return objectTemplate.extend.call(objectTemplate, template, p1, p2); };
        template.mixin = function (p1, p2) { return objectTemplate.mixin.call(objectTemplate, template, p1, p2); };
        template.staticMixin = function (p1, p2) { return objectTemplate.staticMixin.call(objectTemplate, template, p1, p2); };
        template.fromPOJO = function (pojo) {
            objectTemplate.createIfNeeded(template);
            return objectTemplate.fromPOJO(pojo, template);
        };
        template.fromJSON = function (str, idPrefix) {
            objectTemplate.createIfNeeded(template);
            return objectTemplate.fromJSON(str, template, idPrefix);
        };
        template.getProperties = function (includeVirtual) {
            objectTemplate.createIfNeeded(template);
            return ObjectTemplate._getDefineProperties(template, undefined, includeVirtual);
        };
        if (!createTemplateNow) {
            template.__createParameters__ = template.__createParameters__ || [];
            template.__createParameters__.push([mixinTemplate, parentTemplate, propertiesOrTemplate, createProperties, templateName]);
            return template;
        }
        template.prototype = templatePrototype;
        var createProperty = createPropertyFunc.bind(null, functionProperties, templatePrototype, objectTemplate, templateName, objectProperties, defineProperties, parentTemplate);
        // Walk through properties and construct the defineProperties hash of properties, the list of
        // objectProperties that have to be reinstantiated and attach functions to the prototype
        for (var propertyName in propertiesOrTemplate) {
            createProperty(propertyName, null, propertiesOrTemplate, createProperties);
        }
        template.defineProperties = defineProperties;
        template.objectProperties = objectProperties;
        template.functionProperties = functionProperties;
        template.parentTemplate = parentTemplate;
        template.createProperty = createProperty;
        template.props = {};
        var propst = ObjectTemplate._getDefineProperties(template, undefined, true);
        for (var propd in propst) {
            template.props[propd] = propst[propd];
        }
        return template;
    };
    ;
    /**
     * A function to clone the Type System
     * @returns {o}
     * @private
     */
    ObjectTemplate._createObject = function () {
        var newFoo = Object.create(this);
        newFoo.init();
        return newFoo;
    };
    /**
    * Purpose unknown
    * @param {unknown} originally took a context that it threw away
    * @returns {SupertypeLogger}
    */
    ObjectTemplate.createLogger = function () {
        return new SupertypeLogger_1.SupertypeLogger();
    };
    ObjectTemplate.amorphicStatic = ObjectTemplate;
    /**
     * Purpose unknown
     *
     * @param {unknown} pojo unknown
     * @param {unknown} template unknown
     * @param {unknown} defineProperty unknown
     * @param {unknown} idMap unknown
     * @param {unknown} idQualifier unknown
     * @param {unknown} parent unknown
     * @param {unknown} prop unknown
     * @param {unknown} creator unknown
     *
    * @returns {unknown}
    */
    ObjectTemplate.fromPOJO = serializer.fromPOJO;
    /**
    * Purpose unknown
    *
    * @param {unknown} str unknown
    * @param {unknown} template unknown
    * @param {unknown} idQualifier unknown
    * objectTemplate.fromJSON(str, template, idQualifier)
    * @returns {unknown}
    */
    ObjectTemplate.fromJSON = serializer.fromJSON;
    /**
     * Convert an object to JSON, stripping any recursive object references so they can be
     * reconstituted later
     *
     * @param {unknown} obj unknown
     * @param {unknown} cb unknown
     *
     * @returns {unknown}
     */
    ObjectTemplate.toJSONString = serializer.toJSONString;
    return ObjectTemplate;
}());
exports.ObjectTemplate = ObjectTemplate;
function createPropertyFunc(functionProperties, templatePrototype, objectTemplate, templateName, objectProperties, defineProperties, parentTemplate, propertyName, propertyValue, properties, createProperties) {
    if (!properties) {
        properties = {};
        properties[propertyName] = propertyValue;
    }
    // Record the initialization function
    if (propertyName == 'init' && typeof (properties[propertyName]) === 'function') {
        functionProperties.init = [properties[propertyName]];
    }
    else {
        var defineProperty = null; // defineProperty to be added to defineProperties
        // Determine the property value which may be a defineProperties structure or just an initial value
        var descriptor = {};
        if (properties) {
            descriptor = Object.getOwnPropertyDescriptor(properties, propertyName);
        }
        var type = 'null';
        if (descriptor.get || descriptor.set) {
            type = 'getset';
        }
        else if (properties[propertyName] !== null) {
            type = typeof (properties[propertyName]);
        }
        switch (type) {
            // Figure out whether this is a defineProperty structure (has a constructor of object)
            case 'object': // Or array
                // Handle remote function calls
                if (properties[propertyName].body && typeof (properties[propertyName].body) === 'function') {
                    templatePrototype[propertyName] = objectTemplate._setupFunction(propertyName, properties[propertyName].body, properties[propertyName].on, properties[propertyName].validate);
                    if (properties[propertyName].type) {
                        templatePrototype[propertyName].__returns__ = properties[propertyName].type;
                    }
                    if (properties[propertyName].of) {
                        templatePrototype[propertyName].__returns__ = properties[propertyName].of;
                        templatePrototype[propertyName].__returnsarray__ = true;
                    }
                    templatePrototype[propertyName].__on__ = properties[propertyName].on;
                    templatePrototype[propertyName].__validate__ = properties[propertyName].validate;
                    templatePrototype[propertyName].__body__ = properties[propertyName].body;
                    break;
                }
                else if (properties[propertyName].type) {
                    defineProperty = properties[propertyName];
                    properties[propertyName].writable = true; // We are using setters
                    if (typeof (properties[propertyName].enumerable) === 'undefined') {
                        properties[propertyName].enumerable = true;
                    }
                    break;
                }
                else if (properties[propertyName] instanceof Array) {
                    defineProperty = {
                        type: Object,
                        value: properties[propertyName],
                        enumerable: true,
                        writable: true,
                        isLocal: true
                    };
                    break;
                }
                else { // Other crap
                    defineProperty = {
                        type: Object,
                        value: properties[propertyName],
                        enumerable: true,
                        writable: true
                    };
                    break;
                }
            case 'string':
                defineProperty = {
                    type: String,
                    value: properties[propertyName],
                    enumerable: true,
                    writable: true,
                    isLocal: true
                };
                break;
            case 'boolean':
                defineProperty = {
                    type: Boolean,
                    value: properties[propertyName],
                    enumerable: true,
                    writable: true,
                    isLocal: true
                };
                break;
            case 'number':
                defineProperty = {
                    type: Number,
                    value: properties[propertyName],
                    enumerable: true,
                    writable: true,
                    isLocal: true
                };
                break;
            case 'function':
                templatePrototype[propertyName] = objectTemplate._setupFunction(propertyName, properties[propertyName]);
                templatePrototype[propertyName].sourceTemplate = templateName;
                break;
            case 'getset': // getters and setters
                descriptor.templateSource = templateName;
                Object.defineProperty(templatePrototype, propertyName, descriptor);
                Object.getOwnPropertyDescriptor(templatePrototype, propertyName).get.sourceTemplate = templateName;
                break;
        }
        // If a defineProperty to be added
        if (defineProperty) {
            if (typeof descriptor.toClient !== 'undefined') {
                defineProperty.toClient = descriptor.toClient;
            }
            if (typeof descriptor.toServer !== 'undefined') {
                defineProperty.toServer = descriptor.toServer;
            }
            objectTemplate._setupProperty(propertyName, defineProperty, objectProperties, defineProperties, parentTemplate, createProperties);
            defineProperty.sourceTemplate = templateName;
        }
    }
}
;
function bindParams(templateName, objectTemplate, functionProperties, defineProperties, parentTemplate, propertiesOrTemplate, createProperties, objectProperties, templatePrototype, createTemplateNow, mixinTemplate) {
    function template() {
        objectTemplate.createIfNeeded(template, this);
        var templateRef = template;
        objectTemplate.__templateUsage__[templateRef.__name__] = true;
        var parent = templateRef.__parent__;
        while (parent) {
            objectTemplate.__templateUsage__[parent.__name__] = true;
            var parent = parent.__parent__;
        }
        this.__template__ = templateRef;
        if (objectTemplate.__transient__) {
            this.__transient__ = true;
        }
        var prunedObjectProperties = pruneExisting(this, templateRef.objectProperties);
        var prunedDefineProperties = pruneExisting(this, templateRef.defineProperties);
        try {
            // Create properties either with EMCA 5 defineProperties or by hand
            if (Object.defineProperties) {
                Object.defineProperties(this, prunedDefineProperties); // This method will be added pre-EMCA 5
            }
        }
        catch (e) {
            console.log(e); // eslint-disable-line no-console
        }
        this.fromRemote = this.fromRemote || objectTemplate._stashObject(this, templateRef);
        this.copyProperties = function copyProperties(obj) {
            for (var prop in obj) {
                this[prop] = obj[prop];
            }
        };
        // Initialize properties from the defineProperties value property
        for (var propertyName in prunedObjectProperties) {
            var defineProperty = prunedObjectProperties[propertyName];
            if (typeof (defineProperty.init) !== 'undefined') {
                if (defineProperty.byValue) {
                    this[propertyName] = ObjectTemplate.clone(defineProperty.init, defineProperty.of || defineProperty.type || null);
                }
                else {
                    this[propertyName] = (defineProperty.init);
                }
            }
        }
        // Template level injections
        for (var ix = 0; ix < templateRef.__injections__.length; ++ix) {
            templateRef.__injections__[ix].call(this, this);
        }
        // Global injections
        for (var j = 0; j < objectTemplate.__injections__.length; ++j) {
            objectTemplate.__injections__[j].call(this, this);
        }
        this.__prop__ = function g(prop) {
            return ObjectTemplate._getDefineProperty(prop, this.__template__);
        };
        this.__values__ = function f(prop) {
            var defineProperty = this.__prop__(prop) || this.__prop__('_' + prop);
            if (typeof (defineProperty.values) === 'function') {
                return defineProperty.values.call(this);
            }
            return defineProperty.values;
        };
        this.__descriptions__ = function e(prop) {
            var defineProperty = this.__prop__(prop) || this.__prop__('_' + prop);
            if (typeof (defineProperty.descriptions) === 'function') {
                return defineProperty.descriptions.call(this);
            }
            return defineProperty.descriptions;
        };
        // If we don't have an init function or are a remote creation call parent constructor otherwise call init
        //  function who will be responsible for calling parent constructor to allow for parameter passing.
        if (this.fromRemote || !templateRef.functionProperties.init || objectTemplate.noInit) {
            if (parentTemplate && parentTemplate.isObjectTemplate) {
                parentTemplate.call(this);
            }
        }
        else {
            if (templateRef.functionProperties.init) {
                for (var i = 0; i < templateRef.functionProperties.init.length; ++i) {
                    templateRef.functionProperties.init[i].apply(this, arguments);
                }
            }
        }
        this.__template__ = templateRef;
        this.toJSONString = function toJSONString(cb) {
            return ObjectTemplate.toJSONString(this, cb);
        };
        /* Clone and object calling a callback for each referenced object.
         The call back is passed (obj, prop, template)
         obj - the parent object (except the highest level)
         prop - the name of the property
         template - the template of the object to be created
         the function returns:
         - falsy - clone object as usual with a new id
         - object reference - the callback created the object (presumably to be able to pass init parameters)
         - [object] - a one element array of the object means don't copy the properties or traverse
         */
        this.createCopy = function createCopy(creator) {
            return ObjectTemplate.createCopy(this, creator);
        };
    }
    ;
    var returnVal = template;
    return returnVal;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2JqZWN0VGVtcGxhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvT2JqZWN0VGVtcGxhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx5Q0FBMkM7QUFDM0MscURBQW9EO0FBZ0RwRDs7Ozs7Ozs7R0FRRztBQUNILHFCQUFxQixJQUFJLEVBQUUsT0FBTztJQUM5QixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUM7SUFFZixJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxVQUFVLEVBQUU7UUFDOUIsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7S0FDbkM7U0FDSSxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDakMsR0FBRyxHQUFHLEtBQUssQ0FBQztRQUVaLElBQUksT0FBTyxFQUFFO1lBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLElBQUk7Z0JBQ3ZCLDJCQUEyQjtnQkFDM0IsSUFBSSxDQUFDLEdBQUcsRUFBRTtvQkFDTixrQ0FBa0M7b0JBQ2xDLEdBQUcsR0FBRyxJQUFJLElBQUksSUFBSSxDQUFDO2lCQUN0QjtZQUNMLENBQUMsQ0FBQyxDQUFDO1NBQ047S0FDSjtTQUNJLElBQUksSUFBSSxZQUFZLEtBQUssRUFBRTtRQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsSUFBSTtZQUN4QixHQUFHLEdBQUcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7S0FDTjtTQUNJO1FBQ0QsR0FBRyxHQUFHLElBQUksQ0FBQztLQUNkO0lBRUQsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDO0FBRUQsdUJBQXVCLEdBQUcsRUFBRSxLQUFLO0lBQzdCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUVsQixLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssRUFBRTtRQUNwQixJQUFJ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LEVBQUUsQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQztRQUVGOzs7Ozs7Ozs7V0FTRztRQUNILElBQUksQ0FBQyxVQUFVLEdBQUcsb0JBQW9CLE9BQU87WUFDekMsT0FBTyxjQUFjLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUM7SUFFTixDQUFDO0lBQUEsQ0FBQztJQUdGLElBQUksU0FBUyxHQUFhLFFBQVEsQ0FBQztJQUVuQyxPQUFPLFNBQTRCLENBQUM7QUFDeEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHNlcmlhbGl6ZXIgZnJvbSAnLi9zZXJpYWxpemVyJztcbmltcG9ydCB7IFN1cGVydHlwZUxvZ2dlciB9IGZyb20gJy4vU3VwZXJ0eXBlTG9nZ2VyJztcbmltcG9ydCB7IFN0YXRzZENsaWVudEludGVyZmFjZSB9IGZyb20gJy4vU3RhdHNkQ2xpZW50SW50ZXJmYWNlJztcbmV4cG9ydCB0eXBlIENyZWF0ZVR5cGVGb3JOYW1lID0ge1xuICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgdG9DbGllbnQ/OiBib29sZWFuO1xuICAgIHRvU2VydmVyPzogYm9vbGVhbjtcbiAgICBpc0xvY2FsPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgR2V0dGVyID0ge1xuICAgIGdldDogYW55O1xufVxuXG4vKipcbiAqIHRoaXMgaXMgcHJldHR5IG11Y2ggdGhlIGNsYXNzICh0aGUgdGVtcGxhdGUgaXRzZWxmKVxuICogVHJ5IHRvIHVuaWZ5IHRoaXMgd2l0aCB0aGUgU3VwZXJ0eXBlIFR5cGUgKG1heWJlIG1ha2UgdGhpcyBhIHBhcnRpYWwsIGhhdmUgc3VwZXJ0eXBlIGV4dGVuZCB0aGlzKVxuICovXG5leHBvcnQgdHlwZSBDb25zdHJ1Y3RvclR5cGVCYXNlID0gRnVuY3Rpb24gJiB7XG4gICAgYW1vcnBoaWNDbGFzc05hbWU6IGFueTtcbiAgICBfX3NoYWRvd1BhcmVudF9fOiBhbnk7XG4gICAgcHJvcHM/OiBhbnk7XG4gICAgX19wYXJlbnRfXzogYW55O1xuICAgIF9fbmFtZV9fOiBhbnk7XG4gICAgX19jcmVhdGVQYXJhbWV0ZXJzX186IGFueTtcbiAgICBmdW5jdGlvblByb3BlcnRpZXM6IGFueTtcbiAgICBpc09iamVjdFRlbXBsYXRlOiBhbnk7XG4gICAgZXh0ZW5kOiBhbnk7XG4gICAgc3RhdGljTWl4aW46IGFueTtcbiAgICBtaXhpbjogYW55O1xuICAgIGZyb21QT0pPOiBhbnk7XG4gICAgZnJvbUpTT046IGFueTtcbiAgICBnZXRQcm9wZXJ0aWVzOiAoaW5jbHVkZVZpcnR1YWwpID0+IGFueTtcbiAgICBwcm90b3R5cGU6IGFueTtcbiAgICBkZWZpbmVQcm9wZXJ0aWVzOiBhbnk7XG4gICAgb2JqZWN0UHJvcGVydGllczogYW55O1xuICAgIHBhcmVudFRlbXBsYXRlOiBhbnk7XG4gICAgY3JlYXRlUHJvcGVydHk6IGFueTtcbiAgICBfX3RlbXBsYXRlX186IGFueTtcbiAgICBfX2luamVjdGlvbnNfXzogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnN0cnVjdG9yVHlwZSBleHRlbmRzIENvbnN0cnVjdG9yVHlwZUJhc2Uge1xuICAgIG5ldygpO1xufVxuXG5leHBvcnQgdHlwZSBPYmplY3RUZW1wbGF0ZUNsb25lID0gdHlwZW9mIE9iamVjdFRlbXBsYXRlO1xuXG5cbi8qKlxuICogQWxsb3cgdGhlIHByb3BlcnR5IHRvIGJlIGVpdGhlciBhIGJvb2xlYW4gYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBib29sZWFuIG9yIGEgc3RyaW5nXG4gKiBtYXRjaGVkIGFnYWluc3QgYSBydWxlIHNldCBhcnJheSBvZiBzdHJpbmcgaW4gT2JqZWN0VGVtcGxhdGVcbiAqXG4gKiBAcGFyYW0gIHByb3AgdW5rbm93blxuICogQHBhcmFtIHJ1bGVTZXQgdW5rbm93blxuICpcbiAqIEByZXR1cm5zIHtmdW5jdGlvbih0aGlzOk9iamVjdFRlbXBsYXRlKX1cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc1Byb3AocHJvcCwgcnVsZVNldCkge1xuICAgIHZhciByZXQgPSBudWxsO1xuXG4gICAgaWYgKHR5cGVvZiAocHJvcCkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0ID0gcHJvcC5jYWxsKE9iamVjdFRlbXBsYXRlKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIChwcm9wKSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0ID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHJ1bGVTZXQpIHtcbiAgICAgICAgICAgIHJ1bGVTZXQubWFwKGZ1bmN0aW9uIGkocnVsZSkge1xuICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBhbHdheXMgZXhlY3V0ZVxuICAgICAgICAgICAgICAgIGlmICghcmV0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvdWJsZSBlcXVhbHMgb3Igc2luZ2xlIGVxdWFscz9cbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcnVsZSA9PSBwcm9wO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHByb3AgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBwcm9wLmZvckVhY2goZnVuY3Rpb24gaChwcm9wKSB7XG4gICAgICAgICAgICByZXQgPSByZXQgfHwgcHJvY2Vzc1Byb3AocHJvcCwgcnVsZVNldCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0ID0gcHJvcDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmV0O1xufVxuXG5mdW5jdGlvbiBwcnVuZUV4aXN0aW5nKG9iaiwgcHJvcHMpIHtcbiAgICB2YXIgbmV3UHJvcHMgPSB7fTtcblxuICAgIGZvciAodmFyIHByb3AgaW4gcHJvcHMpIHtcbiAgICAgICAgaWYgKHR5cGVvZihvYmpbcHJvcF0pID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgbmV3UHJvcHNbcHJvcF0gPSBwcm9wc1twcm9wXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdQcm9wcztcbn1cblxuLyoqXG4gKiB0aGUgb2cgT2JqZWN0VGVtcGxhdGUsIHdoYXQgZXZlcnl0aGluZyBwaWNrcyBvZmYgb2ZcbiAqL1xuZXhwb3J0IGNsYXNzIE9iamVjdFRlbXBsYXRlIHtcblxuICAgIHN0YXRpYyBsYXp5VGVtcGxhdGVMb2FkOiBhbnk7XG4gICAgc3RhdGljIGlzTG9jYWxSdWxlU2V0OiBhbnk7XG4gICAgc3RhdGljIG5leHRJZDogYW55OyAvLyBmb3Igc3Rhc2hPYmplY3RcbiAgICBzdGF0aWMgX19leGNlcHRpb25zX186IGFueTtcblxuICAgIHN0YXRpYyBfX3RlbXBsYXRlc19fOiBDb25zdHJ1Y3RvclR5cGVbXTtcbiAgICBzdGF0aWMgdG9TZXJ2ZXJSdWxlU2V0OiBzdHJpbmdbXTtcbiAgICBzdGF0aWMgdG9DbGllbnRSdWxlU2V0OiBzdHJpbmdbXTtcblxuICAgIHN0YXRpYyB0ZW1wbGF0ZUludGVyY2VwdG9yOiBhbnk7XG4gICAgc3RhdGljIF9fZGljdGlvbmFyeV9fOiB7IFtrZXk6IHN0cmluZ106IENvbnN0cnVjdG9yVHlwZSB9O1xuICAgIHN0YXRpYyBfX2Fub255bW91c0lkX186IG51bWJlcjtcbiAgICBzdGF0aWMgX190ZW1wbGF0ZXNUb0luamVjdF9fOiB7fTtcbiAgICBzdGF0aWMgbG9nZ2VyOiBhbnk7XG4gICAgbG9nZ2VyOiBTdXBlcnR5cGVMb2dnZXI7XG4gICAgc3RhdGljIF9fdGVtcGxhdGVVc2FnZV9fOiBhbnk7XG4gICAgc3RhdGljIF9faW5qZWN0aW9uc19fOiBGdW5jdGlvbltdO1xuICAgIHN0YXRpYyBfX3RvQ2xpZW50X186IGJvb2xlYW47XG4gICAgc3RhdGljIF9fc3RhdHNkQ2xpZW50X186IFN0YXRzZENsaWVudEludGVyZmFjZTtcbiAgICBzdGF0aWMgYW1vcnBoaWNTdGF0aWMgPSBPYmplY3RUZW1wbGF0ZTtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHN0YXRzRENsaWVudFxuICAgICAqXG4gICAgICogVGhlIHN0YXRzRENsaWVudCBtYXkgYmUgb24gdGhlIGFtb3JwaGljIG9iamVjdCwgYnV0IGl0IHdpbGwgYWx3YXlzXG4gICAgICogcmVkaXJlY3QgaW5zdGVhZCB0byB0aGUgc3RhdHNSZWZlcmVuY2Ugb24gYW1vcnBoaWNTdGF0aWNcbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAdHlwZSB7KFN0YXRzRENsaWVudCB8IHVuZGVmaW5lZCl9XG4gICAgICogQG1lbWJlcm9mIE9iamVjdFRlbXBsYXRlXG4gICAgICovXG4gICAgc3RhdGljIGdldCBzdGF0c2RDbGllbnQoKTogU3RhdHNkQ2xpZW50SW50ZXJmYWNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYW1vcnBoaWNTdGF0aWMuX19zdGF0c2RDbGllbnRfXztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzdGF0c0RDbGllbnQgcmVmZXJlbmNlIG9uIGFtb3JwaGljU3RhdGljXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHR5cGUgeyhTdGF0c0RDbGllbnQgfCB1bmRlZmluZWQpfVxuICAgICAqIEBtZW1iZXJvZiBPYmplY3RUZW1wbGF0ZVxuICAgICAqL1xuICAgIHN0YXRpYyBzZXQgc3RhdHNkQ2xpZW50KHN0YXRzQ2xpZW50OiBTdGF0c2RDbGllbnRJbnRlcmZhY2UpIHtcbiAgICAgICAgdGhpcy5hbW9ycGhpY1N0YXRpYy5fX3N0YXRzZENsaWVudF9fID0gc3RhdHNDbGllbnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHVycG9zZSB1bmtub3duXG4gICAgICovXG4gICAgc3RhdGljIHBlcmZvcm1JbmplY3Rpb25zKCkge1xuICAgICAgICB0aGlzLmdldENsYXNzZXMoKTtcbiAgICAgICAgaWYgKHRoaXMuX190ZW1wbGF0ZXNUb0luamVjdF9fKSB7XG4gICAgICAgICAgICBjb25zdCBvYmplY3RUZW1wbGF0ZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgdGVtcGxhdGVOYW1lIGluIHRoaXMuX190ZW1wbGF0ZXNUb0luamVjdF9fKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLl9fdGVtcGxhdGVzVG9JbmplY3RfX1t0ZW1wbGF0ZU5hbWVdO1xuXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUuaW5qZWN0ID0gZnVuY3Rpb24gaW5qZWN0KGluamVjdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdFRlbXBsYXRlLmluamVjdCh0aGlzLCBpbmplY3Rvcik7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2luamVjdEludG9UZW1wbGF0ZSh0ZW1wbGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgaW5pdCgpIHtcbiAgICAgICAgdGhpcy5fX3RlbXBsYXRlVXNhZ2VfXyA9IHt9O1xuICAgICAgICB0aGlzLl9faW5qZWN0aW9uc19fID0gW107XG4gICAgICAgIHRoaXMuX19kaWN0aW9uYXJ5X18gPSB7fTtcbiAgICAgICAgdGhpcy5fX2Fub255bW91c0lkX18gPSAxO1xuICAgICAgICB0aGlzLl9fdGVtcGxhdGVzVG9JbmplY3RfXyA9IHt9O1xuICAgICAgICB0aGlzLmxvZ2dlciA9IHRoaXMubG9nZ2VyIHx8IHRoaXMuY3JlYXRlTG9nZ2VyKCk7IC8vIENyZWF0ZSBhIGRlZmF1bHQgbG9nZ2VyXG4gICAgfVxuXG4gICAgc3RhdGljIGdldFRlbXBsYXRlQnlOYW1lKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2xhc3NlcygpW25hbWVdO1xuICAgIH1cblxuICAgIC8qKlxuICogUHVycG9zZSB1bmtub3duXG4gKlxuICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZSB1bmtub3duXG4gKiBAcGFyYW0ge3Vua25vd259IG5hbWUgdW5rbm93blxuICogQHBhcmFtIHt1bmtub3dufSBwcm9wcyB1bmtub3duXG4gKi9cbiAgICBzdGF0aWMgc2V0VGVtcGxhdGVQcm9wZXJ0aWVzKHRlbXBsYXRlLCBuYW1lLCBwcm9wcykge1xuICAgICAgICB0aGlzLl9fdGVtcGxhdGVzVG9JbmplY3RfX1tuYW1lXSA9IHRlbXBsYXRlO1xuICAgICAgICB0aGlzLl9fZGljdGlvbmFyeV9fW25hbWVdID0gdGVtcGxhdGU7XG4gICAgICAgIHRlbXBsYXRlLl9fbmFtZV9fID0gbmFtZTtcbiAgICAgICAgdGVtcGxhdGUuX19pbmplY3Rpb25zX18gPSBbXTtcbiAgICAgICAgdGVtcGxhdGUuX19vYmplY3RUZW1wbGF0ZV9fID0gdGhpcztcbiAgICAgICAgdGVtcGxhdGUuX19jaGlsZHJlbl9fID0gW107XG4gICAgICAgIHRlbXBsYXRlLl9fdG9DbGllbnRfXyA9IHByb3BzLl9fdG9DbGllbnRfXztcbiAgICAgICAgdGVtcGxhdGUuX190b1NlcnZlcl9fID0gcHJvcHMuX190b1NlcnZlcl9fO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFB1cnBvc2UgdW5rbm93blxuICAgICAqXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBwcm9wcyB1bmtub3duXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7dW5rbm93bn1cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0VGVtcGxhdGVQcm9wZXJ0aWVzKHByb3BzKSB7XG4gICAgICAgIGxldCB0ZW1wbGF0ZVByb3BlcnRpZXM6IHsgX190b0NsaWVudF9fPzogYW55OyBfX3RvU2VydmVyX18/OiBhbnkgfSA9IHt9O1xuXG4gICAgICAgIGlmIChPYmplY3RUZW1wbGF0ZS5fX3RvQ2xpZW50X18gPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHByb3BzLnRvQ2xpZW50ID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJvY2Vzc1Byb3AocHJvcHMuaXNMb2NhbCwgdGhpcy5pc0xvY2FsUnVsZVNldCkpIHtcbiAgICAgICAgICAgIHByb3BzLnRvU2VydmVyID0gZmFsc2U7XG4gICAgICAgICAgICBwcm9wcy50b0NsaWVudCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGVtcGxhdGVQcm9wZXJ0aWVzLl9fdG9DbGllbnRfXyA9IHByb2Nlc3NQcm9wKHByb3BzLnRvQ2xpZW50LCB0aGlzLnRvQ2xpZW50UnVsZVNldCkgIT0gZmFsc2U7XG4gICAgICAgIHRlbXBsYXRlUHJvcGVydGllcy5fX3RvU2VydmVyX18gPSBwcm9jZXNzUHJvcChwcm9wcy50b1NlcnZlciwgdGhpcy50b1NlcnZlclJ1bGVTZXQpICE9IGZhbHNlO1xuXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZVByb3BlcnRpZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICAgICogQ3JlYXRlIGFuIG9iamVjdCB0ZW1wbGF0ZSB0aGF0IGlzIGluc3RhbnRpYXRlZCB3aXRoIHRoZSBuZXcgb3BlcmF0b3IuXG4gICAgICAgICogcHJvcGVydGllcyBpc1xuICAgICAgICAqXG4gICAgICAgICogQHBhcmFtIHt1bmtub3dufSBuYW1lIHRoZSBuYW1lIG9mIHRoZSB0ZW1wbGF0ZSBvciBhbiBvYmplY3Qgd2l0aFxuICAgICAgICAqICAgICAgICBuYW1lIC0gdGhlIG5hbWUgb2YgdGhlIGNsYXNzXG4gICAgICAgICogICAgICAgIHRvQ2xpZW50IC0gd2hldGhlciB0aGUgb2JqZWN0IGlzIHRvIGJlIHNoaXBwZWQgdG8gdGhlIGNsaWVudCAod2l0aCBzZW1vdHVzKVxuICAgICAgICAqICAgICAgICB0b1NlcnZlciAtIHdoZXRoZXIgdGhlIG9iamVjdCBpcyB0byBiZSBzaGlwcGVkIHRvIHRoZSBzZXJ2ZXIgKHdpdGggc2Vtb3R1cylcbiAgICAgICAgKiAgICAgICAgaXNMb2NhbCAtIGVxdWl2YWxlbnQgdG8gc2V0dGluZyB0b0NsaWVudCAmJiB0b1NlcnZlciB0byBmYWxzZVxuICAgICAgICAqIEBwYXJhbSB7dW5rbm93bn0gcHJvcGVydGllcyBhbiBvYmplY3Qgd2hvc2UgcHJvcGVydGllcyByZXByZXNlbnQgZGF0YSBhbmQgZnVuY3Rpb25cbiAgICAgICAgKiBwcm9wZXJ0aWVzIG9mIHRoZSBvYmplY3QuICBUaGUgZGF0YSBwcm9wZXJ0aWVzIG1heSB1c2UgdGhlIGRlZmluZVByb3BlcnR5XG4gICAgICAgICogZm9ybWF0IGZvciBwcm9wZXJ0aWVzIG9yIG1heSBiZSBwcm9wZXJ0aWVzIGFzc2lnbmVkIGEgTnVtYmVyLCBTdHJpbmcgb3IgRGF0ZS5cbiAgICAgICAgKlxuICAgICAgICAqIEByZXR1cm5zIHsqfSB0aGUgb2JqZWN0IHRlbXBsYXRlXG4gICAgICAgICovXG5cbiAgICBzdGF0aWMgY3JlYXRlKG5hbWU6IHN0cmluZyB8IENyZWF0ZVR5cGVGb3JOYW1lLCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIC8qKiB0aGlzIGJsb2NrIG9ubHkgZXhlY3V0ZXMgb24gY3JlYXRldHlwZWZvcm5hbWUgKi9cbiAgICAgICAgaWYgKG5hbWUgJiYgISh0eXBlb2YgKG5hbWUpID09PSAnc3RyaW5nJykgJiYgbmFtZS5uYW1lKSB7XG4gICAgICAgICAgICB2YXIgcHJvcHMgPSBuYW1lO1xuICAgICAgICAgICAgbmFtZSA9IHByb3BzLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwcm9wcyA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiAobmFtZSkgIT09ICdzdHJpbmcnIHx8IG5hbWUubWF0Y2goL1teQS1aYS16MC05X10vKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbmNvcnJlY3QgdGVtcGxhdGUgbmFtZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiAocHJvcGVydGllcykgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21pc3NpbmcgdGVtcGxhdGUgcHJvcGVydHkgZGVmaW5pdGlvbnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNyZWF0ZVByb3BzID0gdGhpcy5nZXRUZW1wbGF0ZVByb3BlcnRpZXMocHJvcHMpO1xuXG4gICAgICAgIGlmICh0eXBlb2YgKHRoaXMudGVtcGxhdGVJbnRlcmNlcHRvcikgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVJbnRlcmNlcHRvcignY3JlYXRlJywgbmFtZSwgcHJvcGVydGllcyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdGVtcGxhdGU7XG5cbiAgICAgICAgaWYgKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIHRlbXBsYXRlID0gdGhpcy5fY3JlYXRlVGVtcGxhdGUobnVsbCwgT2JqZWN0LCBwcm9wZXJ0aWVzLCBjcmVhdGVQcm9wcywgbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuX2NyZWF0ZVRlbXBsYXRlKG51bGwsIE9iamVjdCwgbmFtZSwgY3JlYXRlUHJvcHMsIG5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRUZW1wbGF0ZVByb3BlcnRpZXModGVtcGxhdGUsIG5hbWUsIGNyZWF0ZVByb3BzKTtcbiAgICAgICAgdGVtcGxhdGUuX19jcmVhdGVQcm9wc19fID0gcHJvcHM7XG5cbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRXh0ZW5kIGFuZCBleGlzdGluZyAocGFyZW50IHRlbXBsYXRlKVxuICAgICAqXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBwYXJlbnRUZW1wbGF0ZSB1bmtub3duXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBuYW1lIHRoZSBuYW1lIG9mIHRoZSB0ZW1wbGF0ZSBvciBhbiBvYmplY3Qgd2l0aFxuICAgICAqICAgICAgICBuYW1lIC0gdGhlIG5hbWUgb2YgdGhlIGNsYXNzXG4gICAgICogICAgICAgIHRvQ2xpZW50IC0gd2hldGhlciB0aGUgb2JqZWN0IGlzIHRvIGJlIHNoaXBwZWQgdG8gdGhlIGNsaWVudCAod2l0aCBzZW1vdHVzKVxuICAgICAqICAgICAgICB0b1NlcnZlciAtIHdoZXRoZXIgdGhlIG9iamVjdCBpcyB0byBiZSBzaGlwcGVkIHRvIHRoZSBzZXJ2ZXIgKHdpdGggc2Vtb3R1cylcbiAgICAgKiAgICAgICAgaXNMb2NhbCAtIGVxdWl2YWxlbnQgdG8gc2V0dGluZyB0b0NsaWVudCAmJiB0b1NlcnZlciB0byBmYWxzZVxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gcHJvcGVydGllcyBhcmUgdGhlIHNhbWUgYXMgZm9yIGNyZWF0ZVxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp9IHRoZSBvYmplY3QgdGVtcGxhdGVcbiAgICAgKi9cbiAgICBzdGF0aWMgZXh0ZW5kKHBhcmVudFRlbXBsYXRlLCBuYW1lOiBzdHJpbmcgfCBDcmVhdGVUeXBlRm9yTmFtZSwgcHJvcGVydGllcykge1xuICAgICAgICBsZXQgcHJvcHM7XG4gICAgICAgIGxldCBjcmVhdGVQcm9wcztcblxuICAgICAgICBpZiAoIXBhcmVudFRlbXBsYXRlLl9fb2JqZWN0VGVtcGxhdGVfXykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbmNvcnJlY3QgcGFyZW50IHRlbXBsYXRlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIChuYW1lKSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIChuYW1lKSAhPT0gJ3N0cmluZycgJiYgbmFtZS5uYW1lKSB7XG4gICAgICAgICAgICBwcm9wcyA9IG5hbWU7XG4gICAgICAgICAgICBuYW1lID0gcHJvcHMubmFtZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHByb3BzID0gcGFyZW50VGVtcGxhdGUuX19jcmVhdGVQcm9wc19fO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiAobmFtZSkgIT09ICdzdHJpbmcnIHx8IG5hbWUubWF0Y2goL1teQS1aYS16MC05X10vKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbmNvcnJlY3QgdGVtcGxhdGUgbmFtZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiAocHJvcGVydGllcykgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21pc3NpbmcgdGVtcGxhdGUgcHJvcGVydHkgZGVmaW5pdGlvbnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGVtcGxhdGUgPSB0aGlzLl9fZGljdGlvbmFyeV9fW25hbWVdO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1RlbXBsYXRlKSB7XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdUZW1wbGF0ZS5fX3BhcmVudF9fICE9IHBhcmVudFRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGVtcGxhdGUuX19wYXJlbnRfXy5fX25hbWVfXyAhPSBwYXJlbnRUZW1wbGF0ZS5fX25hbWVfXykge1xuICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgV0FSTjogQXR0ZW1wdCB0byBleHRlbmQgJHtwYXJlbnRUZW1wbGF0ZS5fX25hbWVfX30gYXMgJHtuYW1lfSBidXQgJHtuYW1lfSB3YXMgYWxyZWFkeSBleHRlbmRlZCBmcm9tICR7ZXhpc3RpbmdUZW1wbGF0ZS5fX3BhcmVudF9fLl9fbmFtZV9ffWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubWl4aW4oZXhpc3RpbmdUZW1wbGF0ZSwgcHJvcGVydGllcyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdUZW1wbGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwcm9wcykge1xuICAgICAgICAgICAgY3JlYXRlUHJvcHMgPSB0aGlzLmdldFRlbXBsYXRlUHJvcGVydGllcyhwcm9wcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mICh0aGlzLnRlbXBsYXRlSW50ZXJjZXB0b3IpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlSW50ZXJjZXB0b3IoJ2V4dGVuZCcsIG5hbWUsIHByb3BlcnRpZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRlbXBsYXRlO1xuXG4gICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuX2NyZWF0ZVRlbXBsYXRlKG51bGwsIHBhcmVudFRlbXBsYXRlLCBwcm9wZXJ0aWVzLCBwYXJlbnRUZW1wbGF0ZSwgbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuX2NyZWF0ZVRlbXBsYXRlKG51bGwsIHBhcmVudFRlbXBsYXRlLCBuYW1lLCBwYXJlbnRUZW1wbGF0ZSwgbmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3JlYXRlUHJvcHMpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0VGVtcGxhdGVQcm9wZXJ0aWVzKHRlbXBsYXRlLCBuYW1lLCBjcmVhdGVQcm9wcyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldFRlbXBsYXRlUHJvcGVydGllcyh0ZW1wbGF0ZSwgbmFtZSwgcGFyZW50VGVtcGxhdGUpO1xuICAgICAgICB9XG4gICAgICAgIHRlbXBsYXRlLl9fY3JlYXRlUHJvcHNfXyA9IHByb3BzO1xuXG4gICAgICAgIC8vIE1haW50YWluIGdyYXBoIG9mIHBhcmVudCBhbmQgY2hpbGQgdGVtcGxhdGVzXG4gICAgICAgIHRlbXBsYXRlLl9fcGFyZW50X18gPSBwYXJlbnRUZW1wbGF0ZTtcbiAgICAgICAgcGFyZW50VGVtcGxhdGUuX19jaGlsZHJlbl9fLnB1c2godGVtcGxhdGUpO1xuXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgbWl4aW4odGVtcGxhdGUsIHByb3BlcnRpZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiAodGhpcy50ZW1wbGF0ZUludGVyY2VwdG9yKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZUludGVyY2VwdG9yKCdjcmVhdGUnLCB0ZW1wbGF0ZS5fX25hbWVfXywgcHJvcGVydGllcyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlVGVtcGxhdGUodGVtcGxhdGUsIG51bGwsIHByb3BlcnRpZXMsIHRlbXBsYXRlLCB0ZW1wbGF0ZS5fX25hbWVfXyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBQdXJwb3NlIHVua25vd25cbiAgICAqXG4gICAgKiBAcGFyYW0ge3Vua25vd259IHRlbXBsYXRlIHVua25vd25cbiAgICAqIEBwYXJhbSB7dW5rbm93bn0gcHJvcGVydGllcyB1bmtub3duXG4gICAgKi9cbiAgICBzdGF0aWMgc3RhdGljTWl4aW4odGVtcGxhdGUsIHByb3BlcnRpZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wIGluIHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIHRlbXBsYXRlW3Byb3BdID0gcHJvcGVydGllc1twcm9wXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBmaXJlIG9uIG9iamVjdCBjcmVhdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZSB1bmtub3duXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaW5qZWN0b3IgdW5rbm93blxuICAgICAqL1xuICAgIHN0YXRpYyBpbmplY3QodGVtcGxhdGUsIGluamVjdG9yOiBGdW5jdGlvbikge1xuICAgICAgICB0ZW1wbGF0ZS5fX2luamVjdGlvbnNfXy5wdXNoKGluamVjdG9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBmdW5jdGlvbiB0aGF0IHdpbGwgZmlyZSBvbiBhbGwgb2JqZWN0IGNyZWF0aW9ucyAoYXBwYXJlbnRseSk/IEp1c3QgYSBndWVzc1xuICAgICAqXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaW5qZWN0b3IgLSB1bmtub3duXG4gICAgICovXG4gICAgc3RhdGljIGdsb2JhbEluamVjdChpbmplY3RvcjogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5fX2luamVjdGlvbnNfXy5wdXNoKGluamVjdG9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIHRlbXBsYXRlIGlmIGl0IG5lZWRzIHRvIGJlIGNyZWF0ZWRcbiAgICAgKiBAcGFyYW0gW3Vua25vd259IHRlbXBsYXRlIHRvIGJlIGNyZWF0ZWRcbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlYXRlSWZOZWVkZWQodGVtcGxhdGU/LCB0aGlzT2JqPykge1xuICAgICAgICBpZiAodGVtcGxhdGUuX19jcmVhdGVQYXJhbWV0ZXJzX18pIHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZVBhcmFtZXRlcnMgPSB0ZW1wbGF0ZS5fX2NyZWF0ZVBhcmFtZXRlcnNfXztcbiAgICAgICAgICAgIGZvciAodmFyIGl4ID0gMDsgaXggPCBjcmVhdGVQYXJhbWV0ZXJzLmxlbmd0aDsgKytpeCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IGNyZWF0ZVBhcmFtZXRlcnNbaXhdO1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlLl9fY3JlYXRlUGFyYW1ldGVyc19fID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVRlbXBsYXRlKHBhcmFtc1swXSwgcGFyYW1zWzFdLCBwYXJhbXNbMl0sIHBhcmFtc1szXSwgcGFyYW1zWzRdLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0ZW1wbGF0ZS5faW5qZWN0UHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlLl9pbmplY3RQcm9wZXJ0aWVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpc09iaikge1xuICAgICAgICAgICAgICAgIC8vdmFyIGNvcHkgPSBuZXcgdGVtcGxhdGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm90b3R5cGVzID0gW3RlbXBsYXRlLnByb3RvdHlwZV07XG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudCA9IHRlbXBsYXRlLl9fcGFyZW50X187XG4gICAgICAgICAgICAgICAgd2hpbGUgKHBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICBwcm90b3R5cGVzLnB1c2gocGFyZW50LnByb3RvdHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5fX3BhcmVudF9fO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpeCA9IHByb3RvdHlwZXMubGVuZ3RoIC0gMTsgaXggPj0gMDsgLS1peCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHByb3RvdHlwZXNbaXhdKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuZm9yRWFjaCgodmFsLCBpeCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXNPYmosIHByb3BzW2l4XSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihwcm90b3R5cGVzW2l4XSwgcHJvcHNbaXhdKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzT2JqLl9fcHJvdG9fXyA9IHRlbXBsYXRlLnByb3RvdHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRDbGFzc2VzKCkge1xuICAgICAgICBpZiAodGhpcy5fX3RlbXBsYXRlc19fKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpeCA9IDA7IGl4IDwgdGhpcy5fX3RlbXBsYXRlc19fLmxlbmd0aDsgKytpeCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IHRoaXMuX190ZW1wbGF0ZXNfX1tpeF07XG4gICAgICAgICAgICAgICAgdGhpcy5fX2RpY3Rpb25hcnlfX1tjb25zdHJ1Y3Rvck5hbWUodGVtcGxhdGUpXSA9IHRlbXBsYXRlO1xuICAgICAgICAgICAgICAgIHRoaXMuX190ZW1wbGF0ZXNUb0luamVjdF9fW2NvbnN0cnVjdG9yTmFtZSh0ZW1wbGF0ZSldID0gdGVtcGxhdGU7XG4gICAgICAgICAgICAgICAgcHJvY2Vzc0RlZmVycmVkVHlwZXModGVtcGxhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fX3RlbXBsYXRlc19fID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0ZW1wbGF0ZU5hbWUxIGluIHRoaXMuX19kaWN0aW9uYXJ5X18pIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSB0aGlzLl9fZGljdGlvbmFyeV9fW3RlbXBsYXRlTmFtZTFdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudFRlbXBsYXRlTmFtZSA9IGNvbnN0cnVjdG9yTmFtZShPYmplY3QuZ2V0UHJvdG90eXBlT2YodGVtcGxhdGUucHJvdG90eXBlKS5jb25zdHJ1Y3Rvcik7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUuX19zaGFkb3dQYXJlbnRfXyA9IHRoaXMuX19kaWN0aW9uYXJ5X19bcGFyZW50VGVtcGxhdGVOYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGUuX19zaGFkb3dQYXJlbnRfXykge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5fX3NoYWRvd1BhcmVudF9fLl9fc2hhZG93Q2hpbGRyZW5fXy5wdXNoKHRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUucHJvcHMgPSB7fTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wc3QgPSBPYmplY3RUZW1wbGF0ZS5fZ2V0RGVmaW5lUHJvcGVydGllcyh0ZW1wbGF0ZSwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BkIGluIHByb3BzdCkge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5wcm9wc1twcm9wZF0gPSBwcm9wc3RbcHJvcGRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9fZXhjZXB0aW9uc19fKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMuX19leGNlcHRpb25zX18ubWFwKGNyZWF0ZU1lc3NhZ2VMaW5lKS5qb2luKCdcXG4nKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTWVzc2FnZUxpbmUoZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gZXhjZXB0aW9uLmZ1bmMoZXhjZXB0aW9uLmNsYXNzKCksIGV4Y2VwdGlvbi5wcm9wKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBwcm9jZXNzRGVmZXJyZWRUeXBlcyh0ZW1wbGF0ZSkge1xuICAgICAgICAgICAgaWYgKHRlbXBsYXRlLnByb3RvdHlwZS5fX2RlZmVycmVkVHlwZV9fKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wIGluIHRlbXBsYXRlLnByb3RvdHlwZS5fX2RlZmVycmVkVHlwZV9fKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmluZVByb3BlcnR5ID0gdGVtcGxhdGUuZGVmaW5lUHJvcGVydGllc1twcm9wXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmluZVByb3BlcnR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gdGVtcGxhdGUucHJvdG90eXBlLl9fZGVmZXJyZWRUeXBlX19bcHJvcF0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWZpbmVQcm9wZXJ0eS50eXBlID09PSBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZVByb3BlcnR5Lm9mID0gdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZVByb3BlcnR5LnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9fZGljdGlvbmFyeV9fO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNvbnN0cnVjdG9yTmFtZShjb25zdHJ1Y3Rvcikge1xuICAgICAgICAgICAgY29uc3QgbmFtZWRGdW5jdGlvbiA9IGNvbnN0cnVjdG9yLnRvU3RyaW5nKCkubWF0Y2goL2Z1bmN0aW9uIChbXihdKikvKTtcbiAgICAgICAgICAgIHJldHVybiBuYW1lZEZ1bmN0aW9uID8gbmFtZWRGdW5jdGlvblsxXSA6IG51bGw7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE92ZXJyaWRkZW4gYnkgb3RoZXIgVHlwZSBTeXN0ZW1zIHRvIGNhY2hlIG9yIGdsb2JhbGx5IGlkZW50aWZ5IG9iamVjdHNcbiAgICAgKiBBbHNvIGFzc2lnbnMgYSB1bmlxdWUgaW50ZXJuYWwgSWQgc28gdGhhdCBjb21wbGV4IHN0cnVjdHVyZXMgd2l0aFxuICAgICAqIHJlY3Vyc2l2ZSBvYmplY3RzIGNhbiBiZSBzZXJpYWxpemVkXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IG9iaiAtIHRoZSBvYmplY3QgdG8gYmUgcGFzc2VkIGR1cmluZyBjcmVhdGlvbiB0aW1lXG4gICAgICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZSAtIHVua25vd25cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt1bmtub3dufVxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBzdGF0aWMgX3N0YXNoT2JqZWN0KG9iaiwgdGVtcGxhdGUpIHtcbiAgICAgICAgaWYgKCFvYmouX19pZF9fKSB7XG4gICAgICAgICAgICBpZiAoIU9iamVjdFRlbXBsYXRlLm5leHRJZCkge1xuICAgICAgICAgICAgICAgIE9iamVjdFRlbXBsYXRlLm5leHRJZCA9IDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9iai5fX2lkX18gPSAnbG9jYWwtJyArIHRlbXBsYXRlLl9fbmFtZV9fICsgJy0nICsgKytPYmplY3RUZW1wbGF0ZS5uZXh0SWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZGVuIGJ5IG90aGVyIFR5cGUgU3lzdGVtcyB0byBpbmplY3Qgb3RoZXIgZWxlbWVudHNcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7X3RlbXBsYXRlfSBfdGVtcGxhdGUgLSB0aGUgb2JqZWN0IHRvIGJlIHBhc3NlZCBkdXJpbmcgY3JlYXRpb24gdGltZVxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiAqL1xuICAgIHN0YXRpYyBfaW5qZWN0SW50b1RlbXBsYXRlKF90ZW1wbGF0ZSkgeyB9O1xuXG4gICAgLyoqXG4gICAgICogVXNlZCBieSB0ZW1wbGF0ZSBzZXR1cCB0byBjcmVhdGUgYW4gcHJvcGVydHkgZGVzY3JpcHRvciBmb3IgdXNlIGJ5IHRoZSBjb25zdHJ1Y3RvclxuICAgICAqXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBwcm9wZXJ0eU5hbWUgaXMgdGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5XG4gICAgICogQHBhcmFtIHt1bmtub3dufSBkZWZpbmVQcm9wZXJ0eSBpcyB0aGUgcHJvcGVydHkgZGVzY3JpcHRvciBwYXNzZWQgdG8gdGhlIHRlbXBsYXRlXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBvYmplY3RQcm9wZXJ0aWVzIGlzIGFsbCBwcm9wZXJ0aWVzIHRoYXQgd2lsbCBiZSBwcm9jZXNzZWQgbWFudWFsbHkuICBBIG5ldyBwcm9wZXJ0eSBpc1xuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkIHRvIHRoaXMgaWYgdGhlIHByb3BlcnR5IG5lZWRzIHRvIGJlIGluaXRpYWxpemVkIGJ5IHZhbHVlXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBkZWZpbmVQcm9wZXJ0aWVzIGlzIGFsbCBwcm9wZXJ0aWVzIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXNcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBBIG5ldyBwcm9wZXJ0eSB3aWxsIGJlIGFkZGVkIHRvIHRoaXMgb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHN0YXRpYyBfc2V0dXBQcm9wZXJ0eShwcm9wZXJ0eU5hbWUsIGRlZmluZVByb3BlcnR5LCBvYmplY3RQcm9wZXJ0aWVzLCBkZWZpbmVQcm9wZXJ0aWVzKSB7XG4gICAgICAgIC8vIERldGVybWluZSB3aGV0aGVyIHZhbHVlIG5lZWRzIHRvIGJlIHJlLWluaXRpYWxpemVkIGluIGNvbnN0cnVjdG9yXG4gICAgICAgIGNvbnN0IHZhbHVlID0gZGVmaW5lUHJvcGVydHkudmFsdWU7XG4gICAgICAgIGNvbnN0IGJ5VmFsdWUgPSB2YWx1ZSAmJiB0eXBlb2YgKHZhbHVlKSAhPT0gJ251bWJlcicgJiYgdHlwZW9mICh2YWx1ZSkgIT09ICdzdHJpbmcnO1xuXG4gICAgICAgIGlmIChieVZhbHVlIHx8ICFPYmplY3QuZGVmaW5lUHJvcGVydGllcyB8fCBkZWZpbmVQcm9wZXJ0eS5nZXQgfHwgZGVmaW5lUHJvcGVydHkuc2V0KSB7XG4gICAgICAgICAgICBvYmplY3RQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgaW5pdDogZGVmaW5lUHJvcGVydHkudmFsdWUsXG4gICAgICAgICAgICAgICAgdHlwZTogZGVmaW5lUHJvcGVydHkudHlwZSxcbiAgICAgICAgICAgICAgICBvZjogZGVmaW5lUHJvcGVydHkub2YsXG4gICAgICAgICAgICAgICAgYnlWYWx1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZGVsZXRlIGRlZmluZVByb3BlcnR5LnZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2hlbiBhIHN1cGVyIGNsYXNzIGJhc2VkIG9uIG9iamVjdFRlbXBsYXRlIGRvbid0IHRyYW5zcG9ydCBwcm9wZXJ0aWVzXG4gICAgICAgIGRlZmluZVByb3BlcnR5LnRvU2VydmVyID0gZmFsc2U7XG4gICAgICAgIGRlZmluZVByb3BlcnR5LnRvQ2xpZW50ID0gZmFsc2U7XG4gICAgICAgIGRlZmluZVByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSA9IGRlZmluZVByb3BlcnR5O1xuXG4gICAgICAgIC8vIEFkZCBnZXR0ZXJzIGFuZCBzZXR0ZXJzXG4gICAgICAgIGlmIChkZWZpbmVQcm9wZXJ0eS5nZXQgfHwgZGVmaW5lUHJvcGVydHkuc2V0KSB7XG4gICAgICAgICAgICBjb25zdCB1c2VyU2V0dGVyID0gZGVmaW5lUHJvcGVydHkuc2V0O1xuXG4gICAgICAgICAgICBkZWZpbmVQcm9wZXJ0eS5zZXQgPSAoZnVuY3Rpb24gZCgpIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgYSBjbG9zdXJlIHRvIHJlY29yZCB0aGUgcHJvcGVydHkgbmFtZSB3aGljaCBpcyBub3QgcGFzc2VkIHRvIHRoZSBzZXR0ZXJcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wID0gcHJvcGVydHlOYW1lO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGModmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJTZXR0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdXNlclNldHRlci5jYWxsKHRoaXMsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZGVmaW5lUHJvcGVydHkuaXNWaXJ0dWFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2BfXyR7cHJvcH1gXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHVzZXJHZXR0ZXIgPSBkZWZpbmVQcm9wZXJ0eS5nZXQ7XG5cbiAgICAgICAgICAgIGRlZmluZVByb3BlcnR5LmdldCA9IChmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlIGNsb3N1cmUgdG8gcmVjb3JkIHByb3BlcnR5IG5hbWUgd2hpY2ggaXMgbm90IHBhc3NlZCB0byB0aGUgZ2V0dGVyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcCA9IHByb3BlcnR5TmFtZTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBiKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlckdldHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmluZVByb3BlcnR5LmlzVmlydHVhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyR2V0dGVyLmNhbGwodGhpcywgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJHZXR0ZXIuY2FsbCh0aGlzLCB0aGlzW2BfXyR7cHJvcH1gXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1tgX18ke3Byb3B9YF07XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIGlmICghZGVmaW5lUHJvcGVydHkuaXNWaXJ0dWFsKSB7XG4gICAgICAgICAgICAgICAgZGVmaW5lUHJvcGVydGllc1tgX18ke3Byb3BlcnR5TmFtZX1gXSA9IHsgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRlbGV0ZSBkZWZpbmVQcm9wZXJ0eS52YWx1ZTtcbiAgICAgICAgICAgIGRlbGV0ZSBkZWZpbmVQcm9wZXJ0eS53cml0YWJsZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb25lIGFuIG9iamVjdCBjcmVhdGVkIGZyb20gYW4gT2JqZWN0VGVtcGxhdGVcbiAgICAgKiBVc2VkIG9ubHkgd2l0aGluIHN1cGVydHlwZSAoc2VlIGNvcHlPYmplY3QgZm9yIGdlbmVyYWwgY29weSlcbiAgICAgKlxuICAgICAqIEBwYXJhbSBvYmogaXMgdGhlIHNvdXJjZSBvYmplY3RcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGUgaXMgdGhlIHRlbXBsYXRlIHVzZWQgdG8gY3JlYXRlIHRoZSBvYmplY3RcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfSBhIGNvcHkgb2YgdGhlIG9iamVjdFxuICAgICAqL1xuICAgIC8vIEZ1bmN0aW9uIHRvIGNsb25lIHNpbXBsZSBvYmplY3RzIHVzaW5nIE9iamVjdFRlbXBsYXRlIGFzIGEgZ3VpZGVcbiAgICBzdGF0aWMgY2xvbmUob2JqLCB0ZW1wbGF0ZT8pIHtcbiAgICAgICAgbGV0IGNvcHk7XG5cbiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShvYmouZ2V0VGltZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgY29weSA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpeCA9IDA7IGl4IDwgb2JqLmxlbmd0aDsgKytpeCkge1xuICAgICAgICAgICAgICAgIGNvcHlbaXhdID0gdGhpcy5jbG9uZShvYmpbaXhdLCB0ZW1wbGF0ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb3B5O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRlbXBsYXRlICYmIG9iaiBpbnN0YW5jZW9mIHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBjb3B5ID0gbmV3IHRlbXBsYXRlKCk7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcCBpbiBvYmopIHtcbiAgICAgICAgICAgICAgICBpZiAocHJvcCAhPSAnX19pZF9fJyAmJiAhKG9ialtwcm9wXSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWZpbmVQcm9wZXJ0eSA9IHRoaXMuX2dldERlZmluZVByb3BlcnR5KHByb3AsIHRlbXBsYXRlKSB8fCB7fTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3B5W3Byb3BdID0gdGhpcy5jbG9uZShvYmpbcHJvcF0sIGRlZmluZVByb3BlcnR5Lm9mIHx8IGRlZmluZVByb3BlcnR5LnR5cGUgfHwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb3B5O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgICAgY29weSA9IHt9O1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BjIGluIG9iaikge1xuICAgICAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkocHJvcGMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlbcHJvcGNdID0gdGhpcy5jbG9uZShvYmpbcHJvcGNdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb3B5O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE92ZXJyaWRkZW4gYnkgb3RoZXIgVHlwZSBTeXN0ZW1zIHRvIGJlIGFibGUgdG8gY3JlYXRlIHJlbW90ZSBmdW5jdGlvbnMgb3JcbiAgICAgKiBvdGhlcndpc2UgaW50ZXJjZXB0IGZ1bmN0aW9uIGNhbGxzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IF9wcm9wZXJ0eU5hbWUgaXMgdGhlIG5hbWUgb2YgdGhlIGZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBwcm9wZXJ0eVZhbHVlIGlzIHRoZSBmdW5jdGlvbiBpdHNlbGZcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfSBhIG5ldyBmdW5jdGlvbiB0byBiZSBhc3NpZ25lZCB0byB0aGUgb2JqZWN0IHByb3RvdHlwZVxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBzdGF0aWMgX3NldHVwRnVuY3Rpb24oX3Byb3BlcnR5TmFtZSwgcHJvcGVydHlWYWx1ZSkge1xuICAgICAgICByZXR1cm4gcHJvcGVydHlWYWx1ZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gKiBQdXJwb3NlIHVua25vd25cbiAqXG4gKiBAcGFyYW0ge3Vua25vd259IG9iaiB1bmtub3duXG4gKiBAcGFyYW0ge3Vua25vd259IGNyZWF0b3IgdW5rbm93blxuICpcbiAqIEByZXR1cm5zIHt1bmtub3dufVxuICovXG4gICAgc3RhdGljIGNyZWF0ZUNvcHkob2JqLCBjcmVhdG9yKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZyb21QT0pPKG9iaiwgb2JqLl9fdGVtcGxhdGVfXywgbnVsbCwgbnVsbCwgdW5kZWZpbmVkLCBudWxsLCBudWxsLCBjcmVhdG9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBYnN0cmFjdCBmdW5jdGlvbiBmb3IgYmVuZWZpdCBvZiBTZW1vdHVzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IGNiIHVua25vd25cbiAgICAgKi9cbiAgICBzdGF0aWMgd2l0aG91dENoYW5nZVRyYWNraW5nKGNiKSB7XG4gICAgICAgIGNiKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHVycG9zZSB1bmtub3duXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IHBvam8gdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gdGVtcGxhdGUgdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gZGVmaW5lUHJvcGVydHkgdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gaWRNYXAgdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gaWRRdWFsaWZpZXIgdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gcGFyZW50IHVua25vd25cbiAgICAgKiBAcGFyYW0ge3Vua25vd259IHByb3AgdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gY3JlYXRvciB1bmtub3duXG4gICAgICpcbiAgICAqIEByZXR1cm5zIHt1bmtub3dufVxuICAgICovXG4gICAgc3RhdGljIGZyb21QT0pPID0gc2VyaWFsaXplci5mcm9tUE9KTztcblxuICAgIC8qKlxuICAgICogUHVycG9zZSB1bmtub3duXG4gICAgKlxuICAgICogQHBhcmFtIHt1bmtub3dufSBzdHIgdW5rbm93blxuICAgICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZSB1bmtub3duXG4gICAgKiBAcGFyYW0ge3Vua25vd259IGlkUXVhbGlmaWVyIHVua25vd25cbiAgICAqIG9iamVjdFRlbXBsYXRlLmZyb21KU09OKHN0ciwgdGVtcGxhdGUsIGlkUXVhbGlmaWVyKVxuICAgICogQHJldHVybnMge3Vua25vd259XG4gICAgKi9cbiAgICBzdGF0aWMgZnJvbUpTT04gPSBzZXJpYWxpemVyLmZyb21KU09OO1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydCBhbiBvYmplY3QgdG8gSlNPTiwgc3RyaXBwaW5nIGFueSByZWN1cnNpdmUgb2JqZWN0IHJlZmVyZW5jZXMgc28gdGhleSBjYW4gYmVcbiAgICAgKiByZWNvbnN0aXR1dGVkIGxhdGVyXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IG9iaiB1bmtub3duXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBjYiB1bmtub3duXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7dW5rbm93bn1cbiAgICAgKi9cbiAgICBzdGF0aWMgdG9KU09OU3RyaW5nID0gc2VyaWFsaXplci50b0pTT05TdHJpbmc7XG5cbiAgICAgICAgIC8qKlxuICAgICAvKipcbiAgICAgICogRmluZCB0aGUgcmlnaHQgc3ViY2xhc3MgdG8gaW5zdGFudGlhdGUgYnkgZWl0aGVyIGxvb2tpbmcgYXQgdGhlXG4gICAgICAqIGRlY2xhcmVkIGxpc3QgaW4gdGhlIHN1YkNsYXNzZXMgZGVmaW5lIHByb3BlcnR5IG9yIHdhbGtpbmcgdGhyb3VnaFxuICAgICAgKiB0aGUgc3ViY2xhc3NlcyBvZiB0aGUgZGVjbGFyZWQgdGVtcGxhdGVcbiAgICAgICpcbiAgICAgICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZSB1bmtub3duXG4gICAgICAqIEBwYXJhbSB7dW5rbm93bn0gb2JqSWQgdW5rbm93blxuICAgICAgKiBAcGFyYW0ge3Vua25vd259IGRlZmluZVByb3BlcnR5IHVua25vd25cbiAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAqIEBwcml2YXRlXG4gICAgICAqL1xuICAgICBzdGF0aWMgX3Jlc29sdmVTdWJDbGFzcyh0ZW1wbGF0ZSwgb2JqSWQsIGRlZmluZVByb3BlcnR5KSB7XG4gICAgICAgIGxldCB0ZW1wbGF0ZU5hbWUgPSAnJztcblxuICAgICAgICBpZiAob2JqSWQubWF0Y2goLy0oW0EtWmEtejAtOV86XSopLS8pKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZU5hbWUgPSBSZWdFeHAuJDE7XG4gICAgICAgIH1cblxuICAgIC8vIFJlc29sdmUgdGVtcGxhdGUgc3ViY2xhc3MgZm9yIHBvbHltb3JwaGljIGluc3RhbnRpYXRpb25cbiAgICAgICAgaWYgKGRlZmluZVByb3BlcnR5ICYmIGRlZmluZVByb3BlcnR5LnN1YkNsYXNzZXMgJiYgb2JqSWQgIT0gJ2Fub255bW91cyknKSB7XG4gICAgICAgICAgICBpZiAodGVtcGxhdGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaXggPSAwOyBpeCA8IGRlZmluZVByb3BlcnR5LnN1YkNsYXNzZXMubGVuZ3RoOyArK2l4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZU5hbWUgPT0gZGVmaW5lUHJvcGVydHkuc3ViQ2xhc3Nlc1tpeF0uX19uYW1lX18pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlID0gZGVmaW5lUHJvcGVydHkuc3ViQ2xhc3Nlc1tpeF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzdWJDbGFzcyA9IHRoaXMuX2ZpbmRTdWJDbGFzcyh0ZW1wbGF0ZSwgdGVtcGxhdGVOYW1lKTtcblxuICAgICAgICAgICAgaWYgKHN1YkNsYXNzKSB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSBzdWJDbGFzcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2FsayByZWN1cnNpdmVseSB0aHJvdWdoIGV4dGVuc2lvbnMgb2YgdGVtcGxhdGUgdmlhIF9fY2hpbGRyZW5fX1xuICAgICAqIGxvb2tpbmcgZm9yIGEgbmFtZSBtYXRjaFxuICAgICAqXG4gICAgICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZSB1bmtub3duXG4gICAgICogQHBhcmFtIHt1bmtub3dufSB0ZW1wbGF0ZU5hbWUgdW5rbm93blxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgc3RhdGljIF9maW5kU3ViQ2xhc3ModGVtcGxhdGUsIHRlbXBsYXRlTmFtZSkge1xuICAgICAgICBpZiAodGVtcGxhdGUuX19uYW1lX18gPT0gdGVtcGxhdGVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpeCA9IDA7IGl4IDwgdGVtcGxhdGUuX19jaGlsZHJlbl9fLmxlbmd0aDsgKytpeCkge1xuICAgICAgICAgICAgY29uc3Qgc3ViQ2xhc3MgPSB0aGlzLl9maW5kU3ViQ2xhc3ModGVtcGxhdGUuX19jaGlsZHJlbl9fW2l4XSwgdGVtcGxhdGVOYW1lKTtcblxuICAgICAgICAgICAgaWYgKHN1YkNsYXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1YkNsYXNzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBoaWdoZXN0IGxldmVsIHRlbXBsYXRlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IHRlbXBsYXRlIHVua25vd25cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBzdGF0aWMgX2dldEJhc2VDbGFzcyh0ZW1wbGF0ZSkge1xuICAgICAgICB3aGlsZSAodGVtcGxhdGUuX19wYXJlbnRfXykge1xuICAgICAgICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5fX3BhcmVudF9fO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgIH1cblxuICAgICAgICAgLyoqXG4gICAgICAqIEFuIG92ZXJyaWRhYmxlIGZ1bmN0aW9uIHVzZWQgdG8gY3JlYXRlIGFuIG9iamVjdCBmcm9tIGEgdGVtcGxhdGUgYW5kIG9wdGlvbmFsbHlcbiAgICAgICogbWFuYWdlIHRoZSBjYWNoaW5nIG9mIHRoYXQgb2JqZWN0ICh1c2VkIGJ5IGRlcml2YXRpdmUgdHlwZSBzeXN0ZW1zKS4gIEl0XG4gICAgICAqIHByZXNlcnZlcyB0aGUgb3JpZ2luYWwgaWQgb2YgYW4gb2JqZWN0XG4gICAgICAqXG4gICAgICAqIEBwYXJhbSB7dW5rbm93bn0gdGVtcGxhdGUgb2Ygb2JqZWN0XG4gICAgICAqIEBwYXJhbSB7dW5rbm93bn0gb2JqSWQgYW5kIGlkIChpZiBwcmVzZW50KVxuICAgICAgKiBAcGFyYW0ge3Vua25vd259IGRlZmluZVByb3BlcnR5IHVua25vd25cbiAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAqIEBwcml2YXRlXG4gICAgICAqL1xuICAgICBzdGF0aWMgX2NyZWF0ZUVtcHR5T2JqZWN0KHRlbXBsYXRlLCBvYmpJZCwgZGVmaW5lUHJvcGVydHkpIHtcbiAgICAgICAgdGVtcGxhdGUgPSB0aGlzLl9yZXNvbHZlU3ViQ2xhc3ModGVtcGxhdGUsIG9iaklkLCBkZWZpbmVQcm9wZXJ0eSk7XG5cbiAgICAgICAgY29uc3Qgb2xkU3Rhc2hPYmplY3QgPSB0aGlzLl9zdGFzaE9iamVjdDtcblxuICAgICAgICBpZiAob2JqSWQpIHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXNoT2JqZWN0ID0gZnVuY3Rpb24gc3Rhc2hPYmplY3QoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBuZXcgdGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy5fc3Rhc2hPYmplY3QgPSBvbGRTdGFzaE9iamVjdDtcblxuICAgICAgICBpZiAob2JqSWQpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlLl9faWRfXyA9IG9iaklkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ld1ZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIGEgcHJvcGVydHkgaW4gdGhlIGRlZmluZVByb3BlcnRpZXMgc2F2ZWQgd2l0aCB0aGUgdGVtcGxhdGUgY2FzY2FkaW5nXG4gICAgICogdXAgdGhlIHByb3RvdHlwZSBjaGFpbiB0byBmaW5kIGl0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IHByb3AgaXMgdGhlIHByb3BlcnR5IGJlaW5nIHNvdWdodFxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gdGVtcGxhdGUgaXMgdGhlIHRlbXBsYXRlIHVzZWQgdG8gY3JlYXRlIHRoZSBvYmplY3QgY29udGFpbmluZyB0aGUgcHJvcGVydHlcbiAgICAgKiBAcmV0dXJucyB7Kn0gdGhlIFwiZGVmaW5lUHJvcGVydHlcIiBzdHJ1Y3R1cmUgZm9yIHRoZSBwcm9wZXJ0eVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgc3RhdGljIF9nZXREZWZpbmVQcm9wZXJ0eShwcm9wLCB0ZW1wbGF0ZSkge1xuICAgICAgICBpZiAodGVtcGxhdGUgJiYgKHRlbXBsYXRlICE9IE9iamVjdCkgJiYgdGVtcGxhdGUuZGVmaW5lUHJvcGVydGllcyAmJiB0ZW1wbGF0ZS5kZWZpbmVQcm9wZXJ0aWVzW3Byb3BdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGUuZGVmaW5lUHJvcGVydGllc1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0ZW1wbGF0ZSAmJiB0ZW1wbGF0ZS5wYXJlbnRUZW1wbGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldERlZmluZVByb3BlcnR5KHByb3AsIHRlbXBsYXRlLnBhcmVudFRlbXBsYXRlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBoYXNoIG9mIGFsbCBwcm9wZXJ0aWVzIGluY2x1ZGluZyB0aG9zZSBpbmhlcml0ZWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gdGVtcGxhdGUgaXMgdGhlIHRlbXBsYXRlIHVzZWQgdG8gY3JlYXRlIHRoZSBvYmplY3QgY29udGFpbmluZyB0aGUgcHJvcGVydHlcbiAgICAgKiBAcGFyYW0ge3Vua25vd259IHJldHVyblZhbHVlIHVua25vd25cbiAgICAgKiBAcGFyYW0ge3Vua25vd259IGluY2x1ZGVWaXJ0dWFsIHVua25vd25cbiAgICAgKiBAcmV0dXJucyB7Kn0gYW4gYXNzb2NpYXRpdmUgYXJyYXkgb2YgZWFjaCBcImRlZmluZVByb3BlcnR5XCIgc3RydWN0dXJlIGZvciB0aGUgcHJvcGVydHlcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHN0YXRpYyBfZ2V0RGVmaW5lUHJvcGVydGllcyh0ZW1wbGF0ZSwgcmV0dXJuVmFsdWUsIGluY2x1ZGVWaXJ0dWFsKSB7XG4gICAgICAgIGlmICghcmV0dXJuVmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVyblZhbHVlID0ge307XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGVtcGxhdGUuZGVmaW5lUHJvcGVydGllcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wIGluIHRlbXBsYXRlLmRlZmluZVByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZVZpcnR1YWwgfHwgIXRlbXBsYXRlLmRlZmluZVByb3BlcnRpZXNbcHJvcF0uaXNWaXJ0dWFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlW3Byb3BdID0gdGVtcGxhdGUuZGVmaW5lUHJvcGVydGllc1twcm9wXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGVtcGxhdGUucGFyZW50VGVtcGxhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2dldERlZmluZVByb3BlcnRpZXModGVtcGxhdGUucGFyZW50VGVtcGxhdGUsIHJldHVyblZhbHVlLCBpbmNsdWRlVmlydHVhbCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBHZW5lcmFsIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0ZW1wbGF0ZXMgdXNlZCBieSBjcmVhdGUsIGV4dGVuZCBhbmQgbWl4aW5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gbWl4aW5UZW1wbGF0ZSAtIHRlbXBsYXRlIHVzZWQgZm9yIGEgbWl4aW5cbiAgICAgKiBAcGFyYW0ge3Vua25vd259IHBhcmVudFRlbXBsYXRlIC0gdGVtcGxhdGUgdXNlZCBmb3IgYW4gZXh0ZW5kXG4gICAgICogQHBhcmFtIHt1bmtub3dufSBwcm9wZXJ0aWVzT3JUZW1wbGF0ZSAtIHByb3BlcnRpZXMgdG8gYmUgYWRkZWQvbXhpZWQgaW5cbiAgICAgKiBAcGFyYW0ge3Vua25vd259IGNyZWF0ZVByb3BlcnRpZXMgdW5rbm93blxuICAgICAqIEBwYXJhbSB7dW5rbm93bn0gdGVtcGxhdGVOYW1lIC0gdGhlIG5hbWUgb2YgdGhlIHRlbXBsYXRlIGFzIGl0IHdpbGwgYmUgc3RvcmVkIHJldHJpZXZlZCBmcm9tIGRpY3Rpb25hcnlcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn1cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgX2NyZWF0ZVRlbXBsYXRlKG1peGluVGVtcGxhdGU/LCBwYXJlbnRUZW1wbGF0ZT8sIHByb3BlcnRpZXNPclRlbXBsYXRlPywgY3JlYXRlUHJvcGVydGllcz8sIHRlbXBsYXRlTmFtZT8sIGNyZWF0ZVRlbXBsYXRlTm93Pykge1xuICAgICAgICAvLyBXZSB3aWxsIHJldHVybiBhIGNvbnN0cnVjdG9yIHRoYXQgY2FuIGJlIHVzZWQgaW4gYSBuZXcgZnVuY3Rpb25cbiAgICAgICAgLy8gdGhhdCB3aWxsIGNhbGwgYW4gaW5pdCgpIGZ1bmN0aW9uIGZvdW5kIGluIHByb3BlcnRpZXMsIGRlZmluZSBwcm9wZXJ0aWVzIHVzaW5nIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzXG4gICAgICAgIC8vIGFuZCBtYWtlIGNvcGllcyBvZiB0aG9zZSB0aGF0IGFyZSByZWFsbHkgb2JqZWN0c1xuICAgICAgICB2YXIgZnVuY3Rpb25Qcm9wZXJ0aWVzOmFueSA9IHt9OyAgICAvLyBXaWxsIGJlIHBvcHVsYXRlZCB3aXRoIGluaXQgZnVuY3Rpb24gZnJvbSBwcm9wZXJ0aWVzXG4gICAgICAgIHZhciBvYmplY3RQcm9wZXJ0aWVzID0ge307ICAgIC8vIExpc3Qgb2YgcHJvcGVydGllcyB0byBiZSBwcm9jZXNzZWQgYnkgaGFuZFxuICAgICAgICB2YXIgZGVmaW5lUHJvcGVydGllcyA9IHt9OyAgICAvLyBMaXN0IG9mIHByb3BlcnRpZXMgdG8gYmUgc2VudCB0byBPYmplY3QuZGVmaW5lUHJvcGVydGllcygpXG4gICAgICAgIHZhciBvYmplY3RUZW1wbGF0ZSA9IHRoaXM7XG4gICAgICAgIHZhciB0ZW1wbGF0ZVByb3RvdHlwZTtcblxuICAgICAgICBmdW5jdGlvbiBGKCkgeyB9ICAgICAvLyBVc2VkIGluIGNhc2Ugb2YgZXh0ZW5kXG5cbiAgICAgICAgaWYgKCF0aGlzLmxhenlUZW1wbGF0ZUxvYWQpIHtcbiAgICAgICAgICAgIGNyZWF0ZVRlbXBsYXRlTm93ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTZXR1cCB2YXJpYWJsZXMgZGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mIGNhbGwgKGNyZWF0ZSwgZXh0ZW5kLCBtaXhpbilcbiAgICAgICAgaWYgKGNyZWF0ZVRlbXBsYXRlTm93KSB7XG4gICAgICAgICAgICBpZiAobWl4aW5UZW1wbGF0ZSkgeyAgICAgICAgLy8gTWl4aW5cbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUlmTmVlZGVkKG1peGluVGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzT3JUZW1wbGF0ZS5pc09iamVjdFRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlSWZOZWVkZWQocHJvcGVydGllc09yVGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIHByb3BlcnRpZXNPclRlbXBsYXRlLmRlZmluZVByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1peGluVGVtcGxhdGUuZGVmaW5lUHJvcGVydGllc1twcm9wXSA9IHByb3BlcnRpZXNPclRlbXBsYXRlLmRlZmluZVByb3BlcnRpZXNbcHJvcF07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wcCBpbiBwcm9wZXJ0aWVzT3JUZW1wbGF0ZS5vYmplY3RQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaXhpblRlbXBsYXRlLm9iamVjdFByb3BlcnRpZXNbcHJvcHBdID0gcHJvcGVydGllc09yVGVtcGxhdGUub2JqZWN0UHJvcGVydGllc1twcm9wcF07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wbyBpbiBwcm9wZXJ0aWVzT3JUZW1wbGF0ZS5mdW5jdGlvblByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wbyA9PSAnaW5pdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaXhpblRlbXBsYXRlLmZ1bmN0aW9uUHJvcGVydGllcy5pbml0ID0gbWl4aW5UZW1wbGF0ZS5mdW5jdGlvblByb3BlcnRpZXMuaW5pdCB8fCBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGl4ID0gMDsgaXggPCBwcm9wZXJ0aWVzT3JUZW1wbGF0ZS5mdW5jdGlvblByb3BlcnRpZXMuaW5pdC5sZW5ndGg7ICsraXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWl4aW5UZW1wbGF0ZS5mdW5jdGlvblByb3BlcnRpZXMuaW5pdC5wdXNoKHByb3BlcnRpZXNPclRlbXBsYXRlLmZ1bmN0aW9uUHJvcGVydGllcy5pbml0W2l4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWl4aW5UZW1wbGF0ZS5mdW5jdGlvblByb3BlcnRpZXNbcHJvcG9dID0gcHJvcGVydGllc09yVGVtcGxhdGUuZnVuY3Rpb25Qcm9wZXJ0aWVzW3Byb3BvXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3BuIGluIHByb3BlcnRpZXNPclRlbXBsYXRlLnByb3RvdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BEZXNjID0gPEdldHRlcj5PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3BlcnRpZXNPclRlbXBsYXRlLnByb3RvdHlwZSwgcHJvcG4pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcERlc2MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobWl4aW5UZW1wbGF0ZS5wcm90b3R5cGUsIHByb3BuLCBwcm9wRGVzYyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcERlc2MuZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg8R2V0dGVyPk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobWl4aW5UZW1wbGF0ZS5wcm90b3R5cGUsIHByb3BuKSkuZ2V0LnNvdXJjZVRlbXBsYXRlID0gcHJvcERlc2MuZ2V0LnNvdXJjZVRlbXBsYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1peGluVGVtcGxhdGUucHJvdG90eXBlW3Byb3BuXSA9IHByb3BlcnRpZXNPclRlbXBsYXRlLnByb3RvdHlwZVtwcm9wbl07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBtaXhpblRlbXBsYXRlLnByb3BzID0ge307XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BzID0gT2JqZWN0VGVtcGxhdGUuX2dldERlZmluZVByb3BlcnRpZXMobWl4aW5UZW1wbGF0ZSwgdW5kZWZpbmVkLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wbSBpbiBwcm9wcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWl4aW5UZW1wbGF0ZS5wcm9wc1twcm9wbV0gPSBwcm9wc1twcm9wbV07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWl4aW5UZW1wbGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmluZVByb3BlcnRpZXMgPSBtaXhpblRlbXBsYXRlLmRlZmluZVByb3BlcnRpZXM7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdFByb3BlcnRpZXMgPSBtaXhpblRlbXBsYXRlLm9iamVjdFByb3BlcnRpZXM7XG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uUHJvcGVydGllcyA9IG1peGluVGVtcGxhdGUuZnVuY3Rpb25Qcm9wZXJ0aWVzO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3RvdHlwZSA9IG1peGluVGVtcGxhdGUucHJvdG90eXBlO1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnRUZW1wbGF0ZSA9IG1peGluVGVtcGxhdGUucGFyZW50VGVtcGxhdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7ICAgICAgICAvLyBFeHRlbmRcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUlmTmVlZGVkKHBhcmVudFRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICBGLnByb3RvdHlwZSA9IHBhcmVudFRlbXBsYXRlLnByb3RvdHlwZTtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3RvdHlwZSA9IG5ldyBGKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbnN0cnVjdG9yIHRoYXQgd2lsbCBiZSByZXR1cm5lZCB3aWxsIG9ubHkgZXZlciBiZSBjcmVhdGVkIG9uY2VcbiAgICAgICAgICovXG4gICAgICAgIHZhciB0ZW1wbGF0ZTogQ29uc3RydWN0b3JUeXBlID0gdGhpcy5fX2RpY3Rpb25hcnlfX1t0ZW1wbGF0ZU5hbWVdIHx8XG4gICAgICAgICAgICBiaW5kUGFyYW1zKHRlbXBsYXRlTmFtZSwgb2JqZWN0VGVtcGxhdGUsIGZ1bmN0aW9uUHJvcGVydGllcyxcbiAgICAgICAgICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzLCBwYXJlbnRUZW1wbGF0ZSwgcHJvcGVydGllc09yVGVtcGxhdGUsXG4gICAgICAgICAgICAgICAgY3JlYXRlUHJvcGVydGllcywgb2JqZWN0UHJvcGVydGllcywgdGVtcGxhdGVQcm90b3R5cGUsXG4gICAgICAgICAgICAgICAgY3JlYXRlVGVtcGxhdGVOb3csIG1peGluVGVtcGxhdGUpXG5cblxuICAgICAgICB0ZW1wbGF0ZS5pc09iamVjdFRlbXBsYXRlID0gdHJ1ZTtcblxuICAgICAgICB0ZW1wbGF0ZS5leHRlbmQgPSAocDEsIHAyKSA9PiBvYmplY3RUZW1wbGF0ZS5leHRlbmQuY2FsbChvYmplY3RUZW1wbGF0ZSwgdGVtcGxhdGUsIHAxLCBwMik7XG4gICAgICAgIHRlbXBsYXRlLm1peGluID0gKHAxLCBwMikgPT4gb2JqZWN0VGVtcGxhdGUubWl4aW4uY2FsbChvYmplY3RUZW1wbGF0ZSwgdGVtcGxhdGUsIHAxLCBwMik7XG4gICAgICAgIHRlbXBsYXRlLnN0YXRpY01peGluID0gKHAxLCBwMikgPT4gb2JqZWN0VGVtcGxhdGUuc3RhdGljTWl4aW4uY2FsbChvYmplY3RUZW1wbGF0ZSwgdGVtcGxhdGUsIHAxLCBwMik7XG5cbiAgICAgICAgdGVtcGxhdGUuZnJvbVBPSk8gPSAocG9qbykgPT4ge1xuICAgICAgICAgICAgb2JqZWN0VGVtcGxhdGUuY3JlYXRlSWZOZWVkZWQodGVtcGxhdGUpO1xuICAgICAgICAgICAgcmV0dXJuIG9iamVjdFRlbXBsYXRlLmZyb21QT0pPKHBvam8sIHRlbXBsYXRlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0ZW1wbGF0ZS5mcm9tSlNPTiA9IChzdHIsIGlkUHJlZml4KSA9PiB7XG4gICAgICAgICAgICBvYmplY3RUZW1wbGF0ZS5jcmVhdGVJZk5lZWRlZCh0ZW1wbGF0ZSk7XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0VGVtcGxhdGUuZnJvbUpTT04oc3RyLCB0ZW1wbGF0ZSwgaWRQcmVmaXgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRlbXBsYXRlLmdldFByb3BlcnRpZXMgPSAoaW5jbHVkZVZpcnR1YWwpID0+IHtcbiAgICAgICAgICAgIG9iamVjdFRlbXBsYXRlLmNyZWF0ZUlmTmVlZGVkKHRlbXBsYXRlKTtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3RUZW1wbGF0ZS5fZ2V0RGVmaW5lUHJvcGVydGllcyh0ZW1wbGF0ZSwgdW5kZWZpbmVkLCBpbmNsdWRlVmlydHVhbCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCFjcmVhdGVUZW1wbGF0ZU5vdykge1xuICAgICAgICAgICAgdGVtcGxhdGUuX19jcmVhdGVQYXJhbWV0ZXJzX18gPSB0ZW1wbGF0ZS5fX2NyZWF0ZVBhcmFtZXRlcnNfXyB8fCBbXTtcbiAgICAgICAgICAgIHRlbXBsYXRlLl9fY3JlYXRlUGFyYW1ldGVyc19fLnB1c2goW21peGluVGVtcGxhdGUsIHBhcmVudFRlbXBsYXRlLCBwcm9wZXJ0aWVzT3JUZW1wbGF0ZSwgY3JlYXRlUHJvcGVydGllcywgdGVtcGxhdGVOYW1lXSk7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgICAgIH1cblxuICAgICAgICB0ZW1wbGF0ZS5wcm90b3R5cGUgPSB0ZW1wbGF0ZVByb3RvdHlwZTtcblxuICAgICAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSBjcmVhdGVQcm9wZXJ0eUZ1bmMuYmluZChudWxsLCBmdW5jdGlvblByb3BlcnRpZXMsIHRlbXBsYXRlUHJvdG90eXBlLCBvYmplY3RUZW1wbGF0ZSwgdGVtcGxhdGVOYW1lLCBvYmplY3RQcm9wZXJ0aWVzLCBkZWZpbmVQcm9wZXJ0aWVzLCBwYXJlbnRUZW1wbGF0ZSk7XG5cblxuICAgICAgICAvLyBXYWxrIHRocm91Z2ggcHJvcGVydGllcyBhbmQgY29uc3RydWN0IHRoZSBkZWZpbmVQcm9wZXJ0aWVzIGhhc2ggb2YgcHJvcGVydGllcywgdGhlIGxpc3Qgb2ZcbiAgICAgICAgLy8gb2JqZWN0UHJvcGVydGllcyB0aGF0IGhhdmUgdG8gYmUgcmVpbnN0YW50aWF0ZWQgYW5kIGF0dGFjaCBmdW5jdGlvbnMgdG8gdGhlIHByb3RvdHlwZVxuICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eU5hbWUgaW4gcHJvcGVydGllc09yVGVtcGxhdGUpIHtcbiAgICAgICAgICAgIGNyZWF0ZVByb3BlcnR5KHByb3BlcnR5TmFtZSwgbnVsbCwgcHJvcGVydGllc09yVGVtcGxhdGUsIGNyZWF0ZVByb3BlcnRpZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGVtcGxhdGUuZGVmaW5lUHJvcGVydGllcyA9IGRlZmluZVByb3BlcnRpZXM7XG4gICAgICAgIHRlbXBsYXRlLm9iamVjdFByb3BlcnRpZXMgPSBvYmplY3RQcm9wZXJ0aWVzO1xuXG4gICAgICAgIHRlbXBsYXRlLmZ1bmN0aW9uUHJvcGVydGllcyA9IGZ1bmN0aW9uUHJvcGVydGllcztcbiAgICAgICAgdGVtcGxhdGUucGFyZW50VGVtcGxhdGUgPSBwYXJlbnRUZW1wbGF0ZTtcblxuXG4gICAgICAgIHRlbXBsYXRlLmNyZWF0ZVByb3BlcnR5ID0gY3JlYXRlUHJvcGVydHk7XG5cbiAgICAgICAgdGVtcGxhdGUucHJvcHMgPSB7fTtcblxuICAgICAgICB2YXIgcHJvcHN0ID0gT2JqZWN0VGVtcGxhdGUuX2dldERlZmluZVByb3BlcnRpZXModGVtcGxhdGUsIHVuZGVmaW5lZCwgdHJ1ZSk7XG5cbiAgICAgICAgZm9yICh2YXIgcHJvcGQgaW4gcHJvcHN0KSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZS5wcm9wc1twcm9wZF0gPSBwcm9wc3RbcHJvcGRdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEEgZnVuY3Rpb24gdG8gY2xvbmUgdGhlIFR5cGUgU3lzdGVtXG4gICAgICogQHJldHVybnMge299XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBzdGF0aWMgX2NyZWF0ZU9iamVjdCgpOiBPYmplY3RUZW1wbGF0ZUNsb25lIHtcbiAgICAgICAgY29uc3QgbmV3Rm9vID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTtcbiAgICAgICAgbmV3Rm9vLmluaXQoKTtcbiAgICAgICAgcmV0dXJuIG5ld0ZvbztcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFB1cnBvc2UgdW5rbm93blxuICAgICogQHBhcmFtIHt1bmtub3dufSBvcmlnaW5hbGx5IHRvb2sgYSBjb250ZXh0IHRoYXQgaXQgdGhyZXcgYXdheVxuICAgICogQHJldHVybnMge1N1cGVydHlwZUxvZ2dlcn1cbiAgICAqL1xuICAgIHN0YXRpYyBjcmVhdGVMb2dnZXIoKTogU3VwZXJ0eXBlTG9nZ2VyIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTdXBlcnR5cGVMb2dnZXIoKTtcbiAgICB9XG5cblxufVxuXG5cbmZ1bmN0aW9uIGNyZWF0ZVByb3BlcnR5RnVuYyhmdW5jdGlvblByb3BlcnRpZXMsIHRlbXBsYXRlUHJvdG90eXBlLCBvYmplY3RUZW1wbGF0ZSwgdGVtcGxhdGVOYW1lLCBvYmplY3RQcm9wZXJ0aWVzLCBkZWZpbmVQcm9wZXJ0aWVzLCBwYXJlbnRUZW1wbGF0ZSxcbiAgICBwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUsIHByb3BlcnRpZXMsIGNyZWF0ZVByb3BlcnRpZXMpIHtcbiAgICBpZiAoIXByb3BlcnRpZXMpIHtcbiAgICAgICAgcHJvcGVydGllcyA9IHt9O1xuICAgICAgICBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0gPSBwcm9wZXJ0eVZhbHVlO1xuICAgIH1cblxuICAgIC8vIFJlY29yZCB0aGUgaW5pdGlhbGl6YXRpb24gZnVuY3Rpb25cbiAgICBpZiAocHJvcGVydHlOYW1lID09ICdpbml0JyAmJiB0eXBlb2YgKHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZnVuY3Rpb25Qcm9wZXJ0aWVzLmluaXQgPSBbcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdXTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBudWxsOyAvLyBkZWZpbmVQcm9wZXJ0eSB0byBiZSBhZGRlZCB0byBkZWZpbmVQcm9wZXJ0aWVzXG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBwcm9wZXJ0eSB2YWx1ZSB3aGljaCBtYXkgYmUgYSBkZWZpbmVQcm9wZXJ0aWVzIHN0cnVjdHVyZSBvciBqdXN0IGFuIGluaXRpYWwgdmFsdWVcbiAgICAgICAgdmFyIGRlc2NyaXB0b3I6YW55ID0ge307XG5cbiAgICAgICAgaWYgKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3BlcnRpZXMsIHByb3BlcnR5TmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdHlwZSA9ICdudWxsJztcblxuICAgICAgICBpZiAoZGVzY3JpcHRvci5nZXQgfHwgZGVzY3JpcHRvci5zZXQpIHtcbiAgICAgICAgICAgIHR5cGUgPSAnZ2V0c2V0JztcbiAgICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0gIT09IG51bGwpIHtcbiAgICAgICAgICAgIHR5cGUgPSB0eXBlb2YgKHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSk7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hldGhlciB0aGlzIGlzIGEgZGVmaW5lUHJvcGVydHkgc3RydWN0dXJlIChoYXMgYSBjb25zdHJ1Y3RvciBvZiBvYmplY3QpXG4gICAgICAgICAgICBjYXNlICdvYmplY3QnOiAvLyBPciBhcnJheVxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByZW1vdGUgZnVuY3Rpb24gY2FsbHNcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLmJvZHkgJiYgdHlwZW9mIChwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0uYm9keSkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVQcm90b3R5cGVbcHJvcGVydHlOYW1lXSA9IG9iamVjdFRlbXBsYXRlLl9zZXR1cEZ1bmN0aW9uKHByb3BlcnR5TmFtZSwgcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLmJvZHksIHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXS5vbiwgcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLnZhbGlkYXRlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUHJvdG90eXBlW3Byb3BlcnR5TmFtZV0uX19yZXR1cm5zX18gPSBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0udHlwZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0ub2YpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUHJvdG90eXBlW3Byb3BlcnR5TmFtZV0uX19yZXR1cm5zX18gPSBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0ub2Y7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3RvdHlwZVtwcm9wZXJ0eU5hbWVdLl9fcmV0dXJuc2FycmF5X18gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVQcm90b3R5cGVbcHJvcGVydHlOYW1lXS5fX29uX18gPSBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0ub247XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUHJvdG90eXBlW3Byb3BlcnR5TmFtZV0uX192YWxpZGF0ZV9fID0gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLnZhbGlkYXRlO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3RvdHlwZVtwcm9wZXJ0eU5hbWVdLl9fYm9keV9fID0gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLmJvZHk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkgPSBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXS53cml0YWJsZSA9IHRydWU7IC8vIFdlIGFyZSB1c2luZyBzZXR0ZXJzXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAocHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLmVudW1lcmFibGUpID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLmVudW1lcmFibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvcGVydGllc1twcm9wZXJ0eU5hbWVdIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBPYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNMb2NhbDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBPdGhlciBjcmFwXG4gICAgICAgICAgICAgICAgICAgIGRlZmluZVByb3BlcnR5ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogT2JqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkgPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlzTG9jYWw6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICBkZWZpbmVQcm9wZXJ0eSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlzTG9jYWw6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGRlZmluZVByb3BlcnR5ID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0sXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpc0xvY2FsOiB0cnVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgICAgICAgIHRlbXBsYXRlUHJvdG90eXBlW3Byb3BlcnR5TmFtZV0gPSBvYmplY3RUZW1wbGF0ZS5fc2V0dXBGdW5jdGlvbihwcm9wZXJ0eU5hbWUsIHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXSk7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQcm90b3R5cGVbcHJvcGVydHlOYW1lXS5zb3VyY2VUZW1wbGF0ZSA9IHRlbXBsYXRlTmFtZTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZ2V0c2V0JzogLy8gZ2V0dGVycyBhbmQgc2V0dGVyc1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0b3IudGVtcGxhdGVTb3VyY2UgPSB0ZW1wbGF0ZU5hbWU7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRlbXBsYXRlUHJvdG90eXBlLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IpO1xuICAgICAgICAgICAgICAgICg8R2V0dGVyPk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGVtcGxhdGVQcm90b3R5cGUsIHByb3BlcnR5TmFtZSkpLmdldC5zb3VyY2VUZW1wbGF0ZSA9IHRlbXBsYXRlTmFtZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGEgZGVmaW5lUHJvcGVydHkgdG8gYmUgYWRkZWRcbiAgICAgICAgaWYgKGRlZmluZVByb3BlcnR5KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGRlc2NyaXB0b3IudG9DbGllbnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkudG9DbGllbnQgPSBkZXNjcmlwdG9yLnRvQ2xpZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdG9yLnRvU2VydmVyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGRlZmluZVByb3BlcnR5LnRvU2VydmVyID0gZGVzY3JpcHRvci50b1NlcnZlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2JqZWN0VGVtcGxhdGUuX3NldHVwUHJvcGVydHkocHJvcGVydHlOYW1lLCBkZWZpbmVQcm9wZXJ0eSwgb2JqZWN0UHJvcGVydGllcywgZGVmaW5lUHJvcGVydGllcywgcGFyZW50VGVtcGxhdGUsIGNyZWF0ZVByb3BlcnRpZXMpO1xuICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkuc291cmNlVGVtcGxhdGUgPSB0ZW1wbGF0ZU5hbWU7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5mdW5jdGlvbiBiaW5kUGFyYW1zKHRlbXBsYXRlTmFtZSwgb2JqZWN0VGVtcGxhdGUsIGZ1bmN0aW9uUHJvcGVydGllcyxcbiAgICBkZWZpbmVQcm9wZXJ0aWVzLCBwYXJlbnRUZW1wbGF0ZSwgcHJvcGVydGllc09yVGVtcGxhdGUsXG4gICAgY3JlYXRlUHJvcGVydGllcywgb2JqZWN0UHJvcGVydGllcywgdGVtcGxhdGVQcm90b3R5cGUsXG4gICAgY3JlYXRlVGVtcGxhdGVOb3csIG1peGluVGVtcGxhdGUpIHtcblxuICAgIGZ1bmN0aW9uIHRlbXBsYXRlKCkge1xuICAgICAgICBvYmplY3RUZW1wbGF0ZS5jcmVhdGVJZk5lZWRlZCh0ZW1wbGF0ZSwgdGhpcyk7XG4gICAgICAgIGxldCB0ZW1wbGF0ZVJlZjogQ29uc3RydWN0b3JUeXBlID0gPENvbnN0cnVjdG9yVHlwZT48RnVuY3Rpb24+dGVtcGxhdGU7XG5cbiAgICAgICAgb2JqZWN0VGVtcGxhdGUuX190ZW1wbGF0ZVVzYWdlX19bdGVtcGxhdGVSZWYuX19uYW1lX19dID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRlbXBsYXRlUmVmLl9fcGFyZW50X187XG4gICAgICAgIHdoaWxlIChwYXJlbnQpIHtcbiAgICAgICAgICAgIG9iamVjdFRlbXBsYXRlLl9fdGVtcGxhdGVVc2FnZV9fW3BhcmVudC5fX25hbWVfX10gPSB0cnVlO1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IHBhcmVudC5fX3BhcmVudF9fO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fX3RlbXBsYXRlX18gPSB0ZW1wbGF0ZVJlZjtcblxuICAgICAgICBpZiAob2JqZWN0VGVtcGxhdGUuX190cmFuc2llbnRfXykge1xuICAgICAgICAgICAgdGhpcy5fX3RyYW5zaWVudF9fID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwcnVuZWRPYmplY3RQcm9wZXJ0aWVzID0gcHJ1bmVFeGlzdGluZyh0aGlzLCB0ZW1wbGF0ZVJlZi5vYmplY3RQcm9wZXJ0aWVzKTtcbiAgICAgICAgdmFyIHBydW5lZERlZmluZVByb3BlcnRpZXMgPSBwcnVuZUV4aXN0aW5nKHRoaXMsIHRlbXBsYXRlUmVmLmRlZmluZVByb3BlcnRpZXMpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgcHJvcGVydGllcyBlaXRoZXIgd2l0aCBFTUNBIDUgZGVmaW5lUHJvcGVydGllcyBvciBieSBoYW5kXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCBwcnVuZWREZWZpbmVQcm9wZXJ0aWVzKTsgLy8gVGhpcyBtZXRob2Qgd2lsbCBiZSBhZGRlZCBwcmUtRU1DQSA1XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZnJvbVJlbW90ZSA9IHRoaXMuZnJvbVJlbW90ZSB8fCBvYmplY3RUZW1wbGF0ZS5fc3Rhc2hPYmplY3QodGhpcywgdGVtcGxhdGVSZWYpO1xuXG4gICAgICAgIHRoaXMuY29weVByb3BlcnRpZXMgPSBmdW5jdGlvbiBjb3B5UHJvcGVydGllcyhvYmopIHtcbiAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgdGhpc1twcm9wXSA9IG9ialtwcm9wXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHByb3BlcnRpZXMgZnJvbSB0aGUgZGVmaW5lUHJvcGVydGllcyB2YWx1ZSBwcm9wZXJ0eVxuICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eU5hbWUgaW4gcHJ1bmVkT2JqZWN0UHJvcGVydGllcykge1xuICAgICAgICAgICAgdmFyIGRlZmluZVByb3BlcnR5ID0gcHJ1bmVkT2JqZWN0UHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIChkZWZpbmVQcm9wZXJ0eS5pbml0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGVmaW5lUHJvcGVydHkuYnlWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzW3Byb3BlcnR5TmFtZV0gPSBPYmplY3RUZW1wbGF0ZS5jbG9uZShkZWZpbmVQcm9wZXJ0eS5pbml0LCBkZWZpbmVQcm9wZXJ0eS5vZiB8fCBkZWZpbmVQcm9wZXJ0eS50eXBlIHx8IG51bGwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbcHJvcGVydHlOYW1lXSA9IChkZWZpbmVQcm9wZXJ0eS5pbml0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vIFRlbXBsYXRlIGxldmVsIGluamVjdGlvbnNcbiAgICAgICAgZm9yICh2YXIgaXggPSAwOyBpeCA8IHRlbXBsYXRlUmVmLl9faW5qZWN0aW9uc19fLmxlbmd0aDsgKytpeCkge1xuICAgICAgICAgICAgdGVtcGxhdGVSZWYuX19pbmplY3Rpb25zX19baXhdLmNhbGwodGhpcywgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHbG9iYWwgaW5qZWN0aW9uc1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iamVjdFRlbXBsYXRlLl9faW5qZWN0aW9uc19fLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICBvYmplY3RUZW1wbGF0ZS5fX2luamVjdGlvbnNfX1tqXS5jYWxsKHRoaXMsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fX3Byb3BfXyA9IGZ1bmN0aW9uIGcocHJvcCkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdFRlbXBsYXRlLl9nZXREZWZpbmVQcm9wZXJ0eShwcm9wLCB0aGlzLl9fdGVtcGxhdGVfXyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fX3ZhbHVlc19fID0gZnVuY3Rpb24gZihwcm9wKSB7XG4gICAgICAgICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSB0aGlzLl9fcHJvcF9fKHByb3ApIHx8IHRoaXMuX19wcm9wX18oJ18nICsgcHJvcCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgKGRlZmluZVByb3BlcnR5LnZhbHVlcykgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmaW5lUHJvcGVydHkudmFsdWVzLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZpbmVQcm9wZXJ0eS52YWx1ZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fX2Rlc2NyaXB0aW9uc19fID0gZnVuY3Rpb24gZShwcm9wKSB7XG4gICAgICAgICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSB0aGlzLl9fcHJvcF9fKHByb3ApIHx8IHRoaXMuX19wcm9wX18oJ18nICsgcHJvcCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgKGRlZmluZVByb3BlcnR5LmRlc2NyaXB0aW9ucykgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmaW5lUHJvcGVydHkuZGVzY3JpcHRpb25zLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZpbmVQcm9wZXJ0eS5kZXNjcmlwdGlvbnM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhbiBpbml0IGZ1bmN0aW9uIG9yIGFyZSBhIHJlbW90ZSBjcmVhdGlvbiBjYWxsIHBhcmVudCBjb25zdHJ1Y3RvciBvdGhlcndpc2UgY2FsbCBpbml0XG4gICAgICAgIC8vICBmdW5jdGlvbiB3aG8gd2lsbCBiZSByZXNwb25zaWJsZSBmb3IgY2FsbGluZyBwYXJlbnQgY29uc3RydWN0b3IgdG8gYWxsb3cgZm9yIHBhcmFtZXRlciBwYXNzaW5nLlxuICAgICAgICBpZiAodGhpcy5mcm9tUmVtb3RlIHx8ICF0ZW1wbGF0ZVJlZi5mdW5jdGlvblByb3BlcnRpZXMuaW5pdCB8fCBvYmplY3RUZW1wbGF0ZS5ub0luaXQpIHtcbiAgICAgICAgICAgIGlmIChwYXJlbnRUZW1wbGF0ZSAmJiBwYXJlbnRUZW1wbGF0ZS5pc09iamVjdFRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50VGVtcGxhdGUuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0ZW1wbGF0ZVJlZi5mdW5jdGlvblByb3BlcnRpZXMuaW5pdCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVtcGxhdGVSZWYuZnVuY3Rpb25Qcm9wZXJ0aWVzLmluaXQubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVSZWYuZnVuY3Rpb25Qcm9wZXJ0aWVzLmluaXRbaV0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9fdGVtcGxhdGVfXyA9IHRlbXBsYXRlUmVmO1xuXG4gICAgICAgIHRoaXMudG9KU09OU3RyaW5nID0gZnVuY3Rpb24gdG9KU09OU3RyaW5nKGNiKSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0VGVtcGxhdGUudG9KU09OU3RyaW5nKHRoaXMsIGNiKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKiBDbG9uZSBhbmQgb2JqZWN0IGNhbGxpbmcgYSBjYWxsYmFjayBmb3IgZWFjaCByZWZlcmVuY2VkIG9iamVjdC5cbiAgICAgICAgIFRoZSBjYWxsIGJhY2sgaXMgcGFzc2VkIChvYmosIHByb3AsIHRlbXBsYXRlKVxuICAgICAgICAgb2JqIC0gdGhlIHBhcmVudCBvYmplY3QgKGV4Y2VwdCB0aGUgaGlnaGVzdCBsZXZlbClcbiAgICAgICAgIHByb3AgLSB0aGUgbmFtZSBvZiB0aGUgcHJvcGVydHlcbiAgICAgICAgIHRlbXBsYXRlIC0gdGhlIHRlbXBsYXRlIG9mIHRoZSBvYmplY3QgdG8gYmUgY3JlYXRlZFxuICAgICAgICAgdGhlIGZ1bmN0aW9uIHJldHVybnM6XG4gICAgICAgICAtIGZhbHN5IC0gY2xvbmUgb2JqZWN0IGFzIHVzdWFsIHdpdGggYSBuZXcgaWRcbiAgICAgICAgIC0gb2JqZWN0IHJlZmVyZW5jZSAtIHRoZSBjYWxsYmFjayBjcmVhdGVkIHRoZSBvYmplY3QgKHByZXN1bWFibHkgdG8gYmUgYWJsZSB0byBwYXNzIGluaXQgcGFyYW1ldGVycylcbiAgICAgICAgIC0gW29iamVjdF0gLSBhIG9uZSBlbGVtZW50IGFycmF5IG9mIHRoZSBvYmplY3QgbWVhbnMgZG9uJ3QgY29weSB0aGUgcHJvcGVydGllcyBvciB0cmF2ZXJzZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jcmVhdGVDb3B5ID0gZnVuY3Rpb24gY3JlYXRlQ29weShjcmVhdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0VGVtcGxhdGUuY3JlYXRlQ29weSh0aGlzLCBjcmVhdG9yKTtcbiAgICAgICAgfTtcblxuICAgIH07XG5cblxuICAgIGxldCByZXR1cm5WYWwgPSA8RnVuY3Rpb24+dGVtcGxhdGU7XG5cbiAgICByZXR1cm4gcmV0dXJuVmFsIGFzIENvbnN0cnVjdG9yVHlwZTtcbn1cbiJdfQ==